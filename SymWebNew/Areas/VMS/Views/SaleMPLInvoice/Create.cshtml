@model VATViewModel.DTOs.SalesInvoiceMPLHeaderVM
@using UIHelper.MVC
@using (Html.BeginForm("CreateEdit", "SaleMPLInvoice", FormMethod.Post, new { enctype = "multipart/form-data", @Id = "frmSaleInvoice" }))
{
    @Html.ValidationSummary(true)
    @Html.HiddenFor(model => model.Id)
    @Html.HiddenFor(model => model.SalesInvoiceNo)
    @Html.HiddenFor(model => model.Post)
    @Html.HiddenFor(model => model.Operation)
    @Html.HiddenFor(model => model.TransactionType)
    @Html.HiddenFor(model => model.BranchId)
    @Html.HiddenFor(model => model.CurrencyRateFromBDT, new { @class = "cCurrencyRateFromBDT" })
    @Html.HiddenFor(model => model.SaleType)
    @Html.HiddenFor(model => model.CurrencyID)
    @Html.HiddenFor(model => model.ProductGroup)
    @Html.HiddenFor(model => model.ReportType)
    @Html.HiddenFor(m => m.FormNumeric)


    <div class="headrow">
        @if (Model.Operation == "update")
        {
            <button type="button" title="Update Data" onclick="SaveData()" class="sym-btn-update">&nbsp;Update</button>

            <button type="button" onclick="window.open('/VMS/NBRReport/MegnaReport_VAT6_3?Id=@Model.Id')" class=" sym-btn-report cVAT6_3Report">&nbsp;VAT 6.3 (Preview)</button>


        }
        else if (Model.Operation == "add")
        {
            <button type="button" title="Save Data" onclick="SaveData()" class="sym-btn-save">&nbsp;Save</button>
        }
        <button type="button" class=" sym-btn-report vat11Report">&nbsp;VAT 6.3</button>
        <button type="button" title="Post Data" onclick="PostData()" class="sym-btn-post">&nbsp;Post</button>
        <button type="button" title="Go To Index" data-url="/VMS/SaleMPLInvoice?ReportType=@Model.ReportType" onclick="GoTo(this)" class="sym-btn-detail">&nbsp;Index</button>
        <button type="button" title="Add New Issue" data-url="/VMS/SaleMPLInvoice/Create?tType=@Model.ReportType" onclick="GoTo(this)" id="" class="sym-btn-add ">&nbsp;New</button>
    </div>
    <div class="clearfix"></div>

    <div class=" tabMenu">
        <ul style="font-size: 1.4em;" class="tabDesign nav nav-tabs">
            <li class="tabDefault active"><a data-toggle="tab" href="#Sale">Sale</a></li>
        </ul>
    </div>
    <div class="clearfix"></div>

    <div class="tab-content">
        <div id="Sale" class="tab-pane fade  in active">
            <div class="thinbox formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Basic</p>
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="editor-label">
                            <label>Invoice No</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.SalesInvoiceNo, new { @placeholder = "New", @class = "trSalesInvoiceNo form-control", @readonly = "readonly" })
                            @Html.ValidationMessageFor(model => model.SalesInvoiceNo)
                        </div>
                    </div>



                    <div class="trk1_5">
                        <div class="editor-label">
                            <label for="InvoiceDateTime">Invoice Date</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.InvoiceDateTime, new { @placeholder = "Invoice Date", @class = " trInvoiceDate trVAT18Date customDatePicker trVAT17Date  required form-control" })
                            @Html.ValidationMessageFor(model => model.InvoiceDateTime)
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-label">
                            <label>Ref.Order</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.CustomerOrder, new { @placeholder = "Customer Ref.Order", @class = "trSalesInvoiceNo form-control" })
                        </div>
                    </div>



                    <div class="trk1_5">
                        <div class="editor-label">
                            <label for="InvoiceDateTime">Ref.Order Date</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.CustomerOrderDate, new { @placeholder = "Customer Order Date", @class = " trCustomerOrderDate trCustomerOrderDate customDatePicker trCustomerOrderDate   form-control" })
                        </div>
                    </div>


                    <div class="col-md-2">
                        <div class="editor-label">
                            <label for="VehicleType">Vehicle Type</label>
                        </div>
                        <div class="editor-field">
                            @Html.SimpleDropDownFor(m => m.VehicleType, "/Config/DropDown/EnumVehicleType", new { @class = " trVehicleType required  form-control  selectDropdown" })
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-label">
                            <label for="VehicleNo">Vehicle No</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.VehicleNo, null, new { @placeholder = "Vehicle No", @class = "cVehicleNo  form-control", @id = "IdVehicleNo" })

                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="col-md-3">
                        <div class="editor-label">
                            <label for="CustomerID">Customer</label>
                        </div>
                        <div class="editor-field s2">
                            @*@Html.SimpleDropDownFor(m => m.CustomerID, "/Config/DropDown/Customer", new { @class = " trCustomerId required  form-control  selectDropdown" })*@
                            @Html.SimpleDropDownFor(m => m.CustomerID, "/Config/DropDown/Customer", new { @class = " trCustomerId required  form-control  selectDropdown" })
                            @*@Html.TextBoxFor(model => model.CustomerName, new { @placeholder = "Customer Name", @class = "cCustomerName form-control", @readonly = "readonly" })
                            @Html.HiddenFor(model => model.CustomerID, new { @class = "trCustomerId form-control" })*@
                        </div>
                    </div>

                    @*<div class="trk_5">
                        <div class="editor-label">
                            <label>&nbsp;</label>
                        </div>
                        <div class="editor-field">
                            <button type="button" title="Click to Search Customer" id="customerBtn" class="sym-btn-search"></button>
                        </div>
                    </div>*@

                    <div class="trk_5">
                        <div class="editor-label">
                            <label>&nbsp;</label>
                        </div>
                        <div class="editor-field">
                            <button type="button" title="Click to add Customer" class="sym-btn-add trkXSBtn" onclick="window.open('/VMS/Customer/Create')"></button>
                            <button type="button" title="Click to load Customers" class="sym-btn-refresh trkXSBtn" data-url="/Config/DropDown/Customer" onclick="refreshDropdown(this, 'CustomerID')"></button>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="editor-label">
                            <label for="DeliveryAddress1">Address</label>
                        </div>
                        <div class="editor-field">
                            @Html.TextAreaFor(model => model.DeliveryAddress, new { @placeholder = "Address", @class = "cDeliveryAddress form-control" })
                            @Html.ValidationMessageFor(model => model.DeliveryAddress)
                        </div>
                    </div>



                </div>
                <div class="row">


                </div>

            </div>


            <div class="thinbox col-md-12 formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Product</p>
                </div>

                <div class=" detailHeadRow ">
                    <div class="row">
                        <div class="col-md-1">
                            <div class="editor-label">
                                <label>Group</label>
                            </div>
                            <div class="editor-field">
                                @*+ @Model.ProductType*@
                                @Html.SimpleDropDownFor(m => m.ProductCategoryId, "//", new { @class = " cProductCategoryId form-control selectDropdown " })
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="editor-label">
                                <label for="Product">Product</label>
                            </div>
                            <div class="editor-field" id="mydiv" data-myval="ProCode">
                                @Html.SimpleDropDown("Product", "/Config/DropDown/Product?IsRaw=" + @Model.ItemNo, new { @class = " trProduct  form-control selectDropdown" })
                            </div>
                        </div>

                        <div class="trk_5">
                            <div class="editor-label">
                                <label>&nbsp;</label>
                            </div>
                            <div class="editor-field">
                                <button type="button" title="Click to Search Product" id="productBtn" class="sym-btn-search"></button>
                            </div>
                        </div>


                        @Html.Hidden("ProductName", "", new { @class = " trProductName" })
                        @Html.Hidden("CConversionDate", "", new { @class = " cDate" })
                        @Html.Hidden("TankCode", "", new { @class = " cdTankCode" })
                        @Html.Hidden("ItemNo", "", new { @class = " trItemNo" })
                        @Html.Hidden("ProductCode", "", new { @class = " trProductCode" })
                        @Html.Hidden("Quantity", "", new { @class = " trQuantity" })
                        @Html.Hidden("IsFixedVAT", "", new { @class = " trIsFixedVAT" })
                        @Html.Hidden("IsPackCal", "", new { @class = " trIsPackCal" })

                        <div class="trk_5">
                            <div class="editor-label">
                                <label for="UOMn">Unit</label>
                            </div>
                            <div class="editor-field">
                                @*<select class="Dropdown form-control DropdownInited trPackSize" id="PackSize" name="UOMn"></select>*@
                                @Html.TextBox("UOMn", "", new { @class = " cUOMn    form-control" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="editor-label">
                                <label for="PkgSize">Pkg.Size</label>
                            </div>
                            <div class="editor-field">
                                @*<select class="Dropdown form-control DropdownInited trPackSize" id="PackSize" name="UOMn"></select>*@
                                @Html.TextBox("PkgSize", "", new { @class = " cPkgSize   form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="trk_5">
                            <div class="editor-label">
                                <label for="UOMc">Volume</label>
                            </div>
                            <div class="editor-field">
                                @*<select class="Dropdown form-control DropdownInited trPackSize" id="PackSize" name="UOMn"></select>*@
                                @Html.TextBox("UOMc", "", new { @class = " cUOMc   priceLen right form-control", @readonly = "readonly" })
                            </div>
                        </div>
                     
                        @Html.HiddenFor(model => model.ReportType)


                        @Html.Hidden("UOM", "", new { @class = " trUOM" })

                        <div class="col-md-1">
                            <div class="editor-label">
                                <label for="Quantity">Pkg. Qty</label>
                            </div>
                            <div class="editor-field">
                                @Html.TextBox("SaleQuantity", "0", new { @class = " cSaleQuantity priceLen right   form-control" })
                            </div>
                        </div>

                        <div class="col-md-1">
                            <div class="editor-label">
                                <label for="Quantity">Total Vol.</label>
                            </div>
                            <div class="editor-field">
                                @Html.TextBox("TotalSaleVolume", "0", new { @class = " cTotalSaleVolume priceLen right   form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="trk_5">
                            <div class="editor-label">
                                <label for="NBRPrice">Rate</label>
                            </div>
                            <div class="editor-field">
                                @Html.TextBox("VATRate", "0", new { @class = " trVATRate right   form-control", @readonly = "readonly" })


                            </div>
                        </div>
                        
                        <div class="col-md-1">
                            <div class="editor-label">
                                <label for="NBRPrice">NBR Price</label>
                            </div>
                            <div class="editor-field input-group">
                                <input type="hidden" class="trUnitPrice" />
                                <input type="hidden" class=" NBRPrice" />
                                @Html.TextBox("NBRPrice", "0", new { @class = " trNBRPrice right   form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="editor-label">
                                <label for="Price">Price</label>
                            </div>
                            <div class="editor-field input-group">
                                <input type="hidden" class="trUnitPrice" />
                                <input type="hidden" class=" NBRPrice" />
                                @Html.TextBox("UnitPriceWithVAT", "0", new { @class = " trUnitPriceWithVAT right   form-control", @readonly = "readonly" })
                            </div>
                        </div>




                        <label>&nbsp;</label>

                        @*<div class="col-md-1">
                                <div class="editor-field">
                                </div>
                            </div>*@
                        <div class="col-md-1">

                            <div class="editor-field input-group">
                                <div id="ItemExist" title="Add Detail" data-url="/Vms/SaleMPLInvoice/BlankItem" class="sym-btn-add-row AddRow" data-container="editorItemRows4">&nbsp;Add</div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="fixedParent">
                    @if (Model.SalesInvoiceMPLDetailVMs != null)
                    {
                        <table class="trkFixTable" id="itemTable">
                            <thead>
                                <tr>
                                    <th onclick="CopyItemTableText(this)">Action</th>
                                    <th>Product Name</th>
                                    <th>Product Code</th>
                                    <th>Package Unit</th>
                                    <th>Package Qty</th>
                                    <th>Total Volume</th>
                                    <th>Unit Price WithVAT</th>
                                    <th>NBR Price</th>
                                    <th>Sub Total</th>
                                    <th>VAT Rate</th>
                                    <th>VAT Amount</th>
                                    <th>Total Amount</th>
                                </tr>
                            </thead>

                            <tbody id="editorItemRows4">

                                @foreach (var item in Model.SalesInvoiceMPLDetailVMs)
                                {
                                    Html.RenderPartial("_detail", item);
                                }
                            </tbody>
                        </table>

                    }
                </div>



                <div class="row trkBelowDiv">

                    <div class="col-md-1 trkLabelTopRight">
                        <label>Supply VAT</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.SupplyVAT, new { @class = " cVATTotal NumberCheck priceLen right form-control" })
                        </div>
                    </div>

                    <div class="col-md-2 trkLabelTopRight">
                        <label>TC</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.TC, new { @class = " cTC NumberCheck priceLen right form-control" })
                        </div>
                    </div>

                    <div class="col-md-1 trkLabelTopRight">
                        <label>LF</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.LF, new { @class = " cLF NumberCheck priceLen right form-control" })
                        </div>
                    </div>


                    <div class="col-md-1 trkLabelTopRight">
                        <label>Fright ToPay</label>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.LessFrightToPay, new { @class = " cLessFrightToPay NumberCheck priceLen right form-control" })
                        </div>
                    </div>


                </div>

                <div class="row trkBelowDiv">
                    <div class="col-md-1 trkLabelTopRight">
                        <label>SC</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.SC, new { @class = " cSC NumberCheck priceLen right form-control" })


                        </div>
                    </div>

                    <div class="col-md-2 trkLabelTopRight">
                        <label>Short/Ex. Amnt</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ShortExcessAmnt, new { @class = " cShortExcessAmnt NumberCheck priceLen right form-control" })
                        </div>
                    </div>

                    <div class="col-md-1 trkLabelTopRight">
                        <label>Toll</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.Toll, new { @class = " cToll NumberCheck priceLen right form-control" })
                        </div>
                    </div>



                    <div class="col-md-1 trkLabelTopRight">
                        <label>Other Total</label>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.OtherTotalAmnt, new { @class = " cOtherTotalAmnt NumberCheck priceLen right form-control", @readonly = "readonly" })
                        </div>
                    </div>

                </div>

                <div class="row trkBelowDiv">
                    <div class="col-md-1 trkLabelTopRight">
                        <label>ATV</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ATV, new { @class = " cATV NumberCheck priceLen right form-control" })


                        </div>
                    </div>
                    <div class="col-md-2 trkLabelTopRight">
                        <label>DC</label>

                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.DC, new { @class = " cDC  NumberCheck priceLen right form-control" })


                        </div>
                    </div>
                    <div class="col-md-1 trkLabelTopRight">
                        <label>RF</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.RF, new { @class = " cRF  NumberCheck priceLen right   form-control" })
                        </div>
                    </div>


                    <div class="col-md-1 trkLabelTopRight">
                        <label>Grand Total</label>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.GrandTotal, new { @class = " cGrandTotal NumberCheck priceLen right form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </div>

                <div class="row trkBelowDiv">
                    <div class="col-md-1 trkLabelTopRight">
                        <label>Other Amnt</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.OtherAmnt, new { @class = " cOtherAmnt NumberCheck priceLen right form-control" })


                        </div>
                    </div>
                   
                </div>


                <br />



                <br />


            </div>


            <div class="thinbox col-md-12 formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Bank Payment</p>
                </div>
                <div class=" paymentBankHeadRow ">
                    <div class="row">
                        @Html.Hidden("IsUsedDS", "", new { @class = " trIsUsedDS" })
                        @Html.Hidden("BankPaymentReceiveId", "", new { @class = " trBankPaymentReceiveId" })


                        <div class="col-md-3">
                            <div class="editor-label">
                                <label for="Bank">Bank Name</label>
                            </div>
                            <div class="editor-field" id="mydiv" data-myval="ProCode">
                                @Html.SimpleDropDown("BankId", "/Config/DropDown/MPLBDBankInformations", new { @class = " trBankId form-control selectDropdown" })


                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="editor-label">
                                <label for="Product">Mode Of Payment</label>
                            </div>
                            <div class="editor-field" id="mydiv" data-myval="ProCode">
                                @Html.SimpleDropDown("ModeOfPayment", "/Config/DropDown/EnumModeOfPayment?type=" + @Model.ReportType, new { @class = " trModeOfPayment  form-control selectDropdown" })
                            </div>
                        </div>



                        <div class="trk1_5">
                            <div class="editor-label">
                                <label for="InstrumentNo">Instrument No</label>
                            </div>
                            <div class="editor-field input-group">
                                @Html.TextBox("InstrumentNo", null, new { @placeholder = "Instrument No", @class = " trInstrumentNo left   form-control" })
                            </div>
                        </div>

                        <div class="trk1_5">
                            <div class="editor-label">
                                <label for="InstrumentDate">Instrument Date</label>
                            </div>
                            <div class="editor-field">
                                @Html.TextBoxFor(model => model.InstrumentDate, new { @placeholder = "Instrument Date", @class = " trInstrumentDate trVAT18Date customDatePicker trVAT17Date  form-control" })
                                @Html.ValidationMessageFor(model => model.InstrumentDate)
                            </div>
                        </div>

                        <div class="trk1_5">
                            <div class="editor-label">
                                <label for="Amount">Amount</label>
                            </div>
                            <div class="editor-field input-group">
                                @Html.TextBox("Amount", "0", new { @class = " cAmount priceLen right   form-control" })
                            </div>
                        </div>


                        <div class="col-md-1">
                            <div class="editor-label">
                                <label>&nbsp;</label>
                            </div>
                            <div class="editor-field input-group">
                                <div title="Add Detail" data-url="/Vms/SaleMPLInvoice/BankPayment" class="sym-btn-add-row AddBankRow" data-container="editorItemRows5">&nbsp;Add</div>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="editor-label">
                                <label>&nbsp;</label>
                            </div>
                            <div class="editor-field input-group">
                                <div title="Add Detail Payment Receive " id="btnPaymentReceiveList" class="sym-btn-add-row ">&nbsp;Add CR</div>
                            </div>
                        </div>

                       
     

                    </div>
                </div>
                <div class="fixedParent">
                    @if (Model.SalesInvoiceMPLBankPaymentVMs != null)
                    {
                        <table class="trkFixTable" id="itemBankTable">
                            <thead>
                                <tr>
                                    <th onclick="CopyItemTableText(this)">Action</th>
                                    <th>Bank Code</th>
                                    <th>Bank Name</th>
                                    <th>Mode Of Payment</th>
                                    <th>Instrument No</th>
                                    <th>Instrument Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>

                            <tbody id="editorItemRows5">
                                @foreach (var item in Model.SalesInvoiceMPLBankPaymentVMs)
                                {
                                    Html.RenderPartial("_bankPayment", item);
                                }
                            </tbody>
                        </table>

                    }
                </div>

                <div class="row trkBelowDiv">


                    <div class="col-md-2 trkLabelTopRight">
                        <label for="TotalPaymentAmnt">Total Payment Amnt.</label>

                    </div>
                    <div class="col-md-2">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.TotalPaymentAmnt, null, new { @class = " cTotalPaymentAmnt NumberCheck  right form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="thinbox col-md-12 formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Credit Information</p>
                </div>
               
                    <div class=" paymentCreditHeadRow ">
                        @Html.Hidden("SalesInvoiceMPLHeaderId", "", new { @class = " trSalesInvoiceMPLHeaderId" })
                        @Html.Hidden("CRId", "", new { @class = " trCRId" })


                    </div>

                    @if (Model.SalesInvoiceMPLCRInfoVMs != null)
                    {

                        <table class="trkFixTable" id="itemCreditTable">
                            <thead>
                                <tr>
                                    @*<th onclick="CopyItemTableText(this)">Action</th>*@
                                    <th>Sales InvoiceNo</th>
                                    <th>Credit Code</th>
                                    <th>Credit Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>

                            <tbody id="editorItemRows6">
                                @foreach (var item in Model.SalesInvoiceMPLCRInfoVMs)
                                {
                                    Html.RenderPartial("_creditInfo", item);
                                }
                            </tbody>
                        </table>

                    }
                <div class="editor-label">
                    <label for="Amount">&nbsp;</label>
                </div>
                <div class="trk1_5">
                    <div class="editor-label">
                        <label for="Amount">Credit Code</label>
                    </div>
                    <div class="editor-field input-group">
                        @Html.TextBoxFor(model => model.NewCRCode, new { @placeholder = "Credit Code", @class = " trNewCRCode form-control", @readonly = "readonly" })
                    </div>
                </div>

                <div class="trk1_5">
                    <div class="editor-label">
                        <label for="Amount">New Credit Amount</label>
                    </div>
                    <div class="editor-field input-group">
                        @Html.TextBoxFor(model => model.TotalNewCRAmnt, new { @class = " trNewCRAmount  priceLen right   form-control", @readonly = "readonly" })
                    </div>
                </div>
            </div>

            <div class="thinbox col-md-12 formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Special Instruction</p>
                </div>

                <div class="col-md-12">
                    <div class="editor-field">
                        @Html.TextAreaFor(model => model.Comments, new { @placeholder = "Special Instruction ", @class = " Date     form-control" })


                    </div>
                </div>
            </div>
            <div class="thinbox col-md-12 formDesign trkMY-0">
                <div class="th_thinbox">
                    <p>Other Information</p>
                </div>

                <div class="row trkBelowDiv">

                    <div class="col-md-2 trkLabelTopRight">
                        <label>Rail Receipt No.</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.RailReceiptNo, null, new { @class = " cRailReceiptNo   form-control" })
                        </div>
                    </div>

                    <div class="col-md-2 trkLabelTopRight">
                        <label>Rail Receipt Date</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.RailReceiptDate, new { @placeholder = "Rail Receipt Date", @class = " trRailReceiptDate trVAT18Date customDatePicker trVAT17Date  form-control" })
                        </div>
                    </div>
                    <div class="col-md-2 trkLabelTopRight">
                        <label>Rail Inv No.</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.RlyInvNo, null, new { @class = " cRlyInvNo  form-control" })
                        </div>
                    </div>

                    <div class="col-md-1 trkLabelTopRight">
                        <label>CR Amount</label>
                    </div>
                    <div class="col-md-2">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.TotalCRAmnt, null, new { @class = " cTotalCRAmnt NumberCheck  right form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </div>

                <div class="row trkBelowDiv">
                    <div class="col-md-2 trkLabelTopRight">
                        <label>Wet Charge</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.WetCharge, new { @class = " cWetCharge NumberCheck right form-control" })
                        </div>
                    </div>
                    <div class="col-md-2 trkLabelTopRight">
                        <label>To Pay</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.ToPay, new { @class = " cToPay  form-control" })
                        </div>
                    </div>
                    <div class="col-md-2 trkLabelTopRight">
                        <label>Prepaid</label>
                    </div>
                    <div class="col-md-1">
                        <div class="editor-field">
                            @Html.TextBoxFor(m => m.Prepaid,  new { @class = " cPrepaid form-control" })
                        </div>
                    </div>

                </div>
            </div>
            <div class="headrow">
                @if (Model.Operation == "update")
                {
                    <button type="button" title="Update Data" onclick="SaveData()" class="sym-btn-update">&nbsp;Update</button>
                    <button type="button" onclick="window.open('/VMS/NBRReport/MegnaReport_VAT6_3?Id=@Model.Id')" class=" sym-btn-report cVAT6_3Report">&nbsp;VAT 6.3 (Preview)</button>

                }
                else if (Model.Operation == "add")
                {
                    <button type="button" title="Save Data" onclick="SaveData()" class="sym-btn-save">&nbsp;Save</button>
                }
                <button type="button" class=" sym-btn-report vat11Report">&nbsp;VAT 6.3</button>
                <button type="button" title="Post Data" onclick="PostData()" class="sym-btn-post">&nbsp;Post</button>
                <button type="button" title="Go To Index" data-url="/VMS/SaleMPLInvoice?ReportType=@Model.ReportType" onclick="GoTo(this)" class="sym-btn-detail">&nbsp;Index</button>
                <button type="button" title="Add New Issue" data-url="/VMS/SaleMPLInvoice/Create?tType=@Model.ReportType" onclick="GoTo(this)" id="" class="sym-btn-add ">&nbsp;New</button>
            </div>

        </div>
    </div>
}
<div id="myModal" class="trkmodal"></div>
<div id="productDetails" class="trkmodal">
    <div class="trkmodal-content">
    </div>
</div>

<div id="myHigherModal" class="HigherModal"></div>
@section Scripts {

    @Scripts.Render("~/bundles/jqueryval")

    <script>

        $(document).ready(function () {
            debugger;

            callingFixedTable();
            callingFixedBankTable();
            callingFixedCreditTable();
            var VehicleType = '@Model.VehicleType';
            VehicleSelect(VehicleType);
        });

        function BillingPeriodPopUp(sender) {


            var url = "/Vms/SaleMPLInvoice/PopUpBillingPeriod";

            var $closestRow = $(sender).closest('.tablerow');

            var code = $closestRow.find('.dItemNo').val();
            var name = $closestRow.find('.dItemName').val();
            var UOM = $closestRow.find('.dUOM').val();
            var Quantity = $closestRow.find('.dQuantity').val();
            var PromotionalQuantity = $closestRow.find('.dPQuantity').val();
            var NBRPrice = $closestRow.find('.dSalesPrice').val();
            var vSubTotal = $closestRow.find('.dSubTotal').val();
            var SD = $closestRow.find('.dSD').val();
            var SDAmount = $closestRow.find('.dSDAmount').val();
            var VATRate = $closestRow.find('.dVATRate').val();
            var VATAmount = $closestRow.find('.dVATAmount').val();
            var Total = $closestRow.find('.dTotal').val();

            var HPSRate = $closestRow.find('.dHPSRate').val();
            var HPSAmount = $closestRow.find('.dHPSAmount').val();
            var TradingMarkUp = $closestRow.find('.dTradingD').val();

            var Type = $closestRow.find('.dType').val();
            var UOMPrice = $closestRow.find('.dBasePrice').val();
            var UOMc = $closestRow.find('.dConvFactor').val();
            var UOMn = $closestRow.find('.dBaseUOM').val();
            var UOMQty = $closestRow.find('.dBaseQty').val();
            var CurrencyValue = $closestRow.find('.dBDT').val();
            var DollerValue = $closestRow.find('.dDollerValue').val();
            var VatName = $closestRow.find('.dVatName').val();

            var BOMId = $closestRow.find('.dBOMId').val();
            var BOMReferenceNo = $closestRow.find('.dBOMReferenceNo').val();


            var CConversionDate = $closestRow.find('.dCConversionDate').val();
            var Weight = $closestRow.find('.dWeight').val();
            var ValueOnly = $closestRow.find('.dValueOnly').val();
            var TotalValue = $closestRow.find('.dTotalValue').val();
            var WareHouseRent = $closestRow.find('.dWareHouseRent').val();
            var WareHouseVAT = $closestRow.find('.dWareHouseVAT').val();
            var ATVRate = $closestRow.find('.dATVRate').val();
            var ATVablePrice = $closestRow.find('.dATVablePrice').val();
            var ATVAmount = $closestRow.find('.dATVAmount').val();
            var IsCommercialImporter = $closestRow.find('.dIsCommercialImporter').val();
            var VDSAmountD = $closestRow.find('.dVDSAmount').val();
            var ProductDescription = $closestRow.find('.dProductDescription').val();

            var IsFixedVAT = $closestRow.find('.dIsFixedVAT').val();
            var FixedVATAmount = $closestRow.find('.dFixedVATAmount').val();
            var BENumber = $closestRow.find('.dBENumber').val();
            var BillingPeriodFrom = $closestRow.find('.dBillingPeriodFrom').val();
            var BillingPeriodTo = $closestRow.find('.dBillingPeriodTo').val();
            var BillingDays = $closestRow.find('.dBillingDays').val();
            var TradingD = $closestRow.find('.dTrading').val();
            var ItemNo = $closestRow.find('.dItem_No').val();
            var NonStockD = $closestRow.find('.dNonStockD').val();
            var SaleTypeD = $closestRow.find('.dSaleTypeD').val();
            var CommentsD = $closestRow.find('.dCommentsD').val();
            var InvoiceLineNo = $closestRow.find('.dInvoiceLineNo').val();
            var TransactionType = $closestRow.find('.dTransactionType').val();

            var modelData = {
                ProductCode: code,
                ProductName: name,
                UOM: UOM,
                Quantity: Quantity,
                PromotionalQuantity: PromotionalQuantity,
                NBRPrice: NBRPrice,
                SubTotal: vSubTotal,
                SD: SD,
                SDAmount: SDAmount,
                VATRate: VATRate,
                VATAmount: VATAmount,
                Total: Total,
                HPSRate: HPSRate,
                HPSAmount: HPSAmount,
                TradingMarkUp: TradingMarkUp,
                Type: Type,
                UOMPrice: UOMPrice,
                UOMc: UOMc,
                UOMn: UOMn,
                UOMQty: UOMQty,
                CurrencyValue: CurrencyValue,
                DollerValue: DollerValue,
                VatName: VatName,
                BOMId: BOMId,
                BOMReferenceNo: BOMReferenceNo,
                CConversionDate: CConversionDate,
                Weight: Weight,
                ValueOnly: ValueOnly,
                TotalValue: TotalValue,
                WareHouseRent: WareHouseRent,
                WareHouseVAT: WareHouseVAT,
                ATVRate: ATVRate,
                ATVablePrice: ATVablePrice,
                ATVAmount: ATVAmount,
                IsCommercialImporter: IsCommercialImporter,
                VDSAmountD: VDSAmountD,
                ProductDescription: ProductDescription,

                IsFixedVAT: IsFixedVAT,
                FixedVATAmount: FixedVATAmount,
                BENumber: BENumber,
                BillingPeriodFrom: BillingPeriodFrom,
                BillingPeriodTo: BillingPeriodTo,
                BillingDays: BillingDays,

                ItemNo: ItemNo,
                TradingD: TradingD,
                NonStockD: NonStockD,
                SaleTypeD: SaleTypeD,
                CommentsD: CommentsD,
                TransactionType: TransactionType,
                InvoiceLineNo: InvoiceLineNo

            }

            $(sender).parents("tr:first").remove();

            SubTotal();

            var modal = document.getElementById('myHigherModal');

            $.ajax({
                data: modelData,
                url: url,
                cache: false,
                beforeSend: function () { $(".loading").show(); },
                success: function (html) {
                    modal.style.display = "block";
                    $("#myHigherModal").html(html);

                }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }

            });


        }
                        
        function LoadTankInfo(data) {
            debugger;
            var $closestRow = $(data).closest('.tablerow');
            var itemNo = $closestRow.find('.dItem_No').val();
            var masterId = $closestRow.find('.dMasterId').val() || 0;
            var tankId = $closestRow.find('.dTankId').val() || 0;
            ShowModal(itemNo, masterId, tankId);
        };
        
        function ShowModal(itemId, masterId, tankId) {
            debugger;
            var modal = document.getElementById('myHigherModal');
            var url = "/Vms/SaleMPLInvoice/LoadTankInfo?ItemNo=" + itemId + "&MasterId=" + masterId + "&TankId="+tankId+"";
            $.ajax({
                url: url,
                cache: false,
                beforeSend: function () { $(".loading").show(); },
                success: function (html) {
                    debugger;
                    modal.style.display = "block";
                    $("#myHigherModal").html(html);
                }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            });
        };

    </script>

    @*--------------------------Autocomplete--------------------------*@
    <script>


        $(function () {
            //alert(1);
            $('#IdVehicleNo').autocomplete({ source: '@Url.Action("AutocompleteVehicle", "Autocomplete", new { area = "Config" })', minLength: 2 });

        });

        $(document).ready(function () {
            $('#IdVehicleNo').on('autocompletechange selected ', function () {
                //var VehicleNo = this.value;
                //alert(VehicleNo);
                //vehicleChange();
            })
            
            
        });

        $(function () {
            $('.trCustomerId').change(function () {

                debugger;
                CustomerChange();
            });
        });;
       
        function CustomerChange() {
            debugger;
            var CustomerId = $('.trCustomerId :selected').val();

            if (CustomerId == null || CustomerId == "") {
                return;
            }

            var url = "/Vms/SaleInvoice/getCustomerAddress?CustomerId=" + CustomerId;
            $.getJSON(url, function (data) {

                debugger;

                $('.cDeliveryAddress').val(data.Address1);
                $('.cSC').val(data.SC);
                $('.cRF').val(data.RF);
                $('.cLF').val(data.SSLF);
                $('.cDC').val(data.DC);
                var OtherTotal = parseFloat(data.SC) + parseFloat(data.RF) + parseFloat(data.SSLF) + parseFloat(data.DC);
                $('.cOtherTotalAmnt').val(OtherTotal);
                
            });
            if ('@Model.ReportType' === "SA-01") {
                CRInfoLoad(CustomerId);

            }

        }




        function CRInfoLoad(CustomerId) {
            debugger;


            var url = "/Vms/SaleMPLInvoice/GetFilteredCRInfo?CustomerId=" + CustomerId+"&SalesInvoiceMPLHeaderId=@Model.Id";
            $.getJSON(url, function (data) {

                debugger;
                var container = "editorItemRows6"
                var url = "/Vms/SaleMPLInvoice/CreditInfo";
                $("#" + container).empty();

                var count = 0;

                $('.dCRCode').each(function () {
                    var existing = $(this).val();
                    if (data.CRCode == existing) {
                        count++;
                    }
                });


                if (count > 0) {
                    ShowResult("Fail", "CRCode already exists!");
                    return;
                }

                var Vmodel = {
                    CRCode: data.CRCode
                    , CRDate: data.CRDate
         , SalesInvoiceMPLHeaderId: data.SalesInvoiceMPLHeaderId
         , SalesInvoiceNo: data.SalesInvoiceNo
         , Amount: data.Amount
                }
                console.log(data.length)
                if (data.CRCode != "" && data.CRCode!=null) {
                    AddCreditRow(container, url, Vmodel);
                }
            });
        }

        $(function () {
            $('.cBOMReferenceNo').change(function () {
                BOMReferenceNoChange();
            });
        });

        function BOMReferenceNoChange() {

            var issueDate = $(".trInvoiceDate").val();
            var vatName = $(".trVAT1Name").val();
            var BOMReferenceNo = $('.cBOMReferenceNo :selected').val();
            var ItemNo = $('.trItemNo').val();
            if (BOMReferenceNo == null || BOMReferenceNo == "" || BOMReferenceNo == "N/A" || BOMReferenceNo == "NA") {
                return;
            }
            if (ItemNo == null || ItemNo == "") {
                return;
            }


            var url = "/Vms/SaleInvoice/getNBRPriceByBOMReferenceNo?BOMReferenceNo=" + BOMReferenceNo + "&ItemNo=" + ItemNo + "&issueDate=" + issueDate + "&vatName=" + vatName;
            $.getJSON(url, function (data) {

                //alert(data.Address1);

                $('.trNBRPrice').val(data.NBRPrice);
                $('.cBOMId').val(data.BOMId);

            });
        }

    </script>

    @*--------------------------Integration--------------------------*@

    <script>
        $(function () {

            $('.saleIntegration_BCL').click(function () {

                var url = "/Vms/Integration/ViewSaleForm_BCL";

                var modal = document.getElementById('myHigherModal');
                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myHigherModal").html(html);
                    }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                });

            });
        });

    </script>

    @*--------------------------FormMaker--------------------------*@
    <script>
        $(function () {
            FormMaker();

            var ProductCategoryId = $("#ProductCategoryId").val();
            var ProductGroup = $("#ProductGroup").val();
            LoadcProductCategoryDropDown(ProductGroup, ProductCategoryId);

        });

        function FormMaker() {
            var tType = '@Model.TransactionType';
            switch (tType) {
                case "Other":
                    {

                    }
                    break;
                default:
                    break;
            }
        }

    </script>

    @*--------------------------addrow and changing product and vehicles--------------------------*@
    <script>
       

        $('.AddRow').on("click", function () {
            debugger;
            var product = $('.trProductName').val();
            if (product == "0" || product == "") {
                ShowResult("Fail", "Select a product first!");
                return;
            }

            var SaleQuantity = parseFloat($('.cSaleQuantity').val().replace(/\,/g, ''));
            if (isNaN(SaleQuantity) || SaleQuantity <= 0) {
                ShowResult("Fail", "Quantity can not be zero");
                $('.cSaleQuantity').css('background-color', 'yellow');
                return;
            }

            var convFact = GetConvFact();
            var itemNo = $('.trProductCode').val();
            var count = 0;


            $('.trQuantity').val(SaleQuantity);

            var container = $(this).attr('data-container');
            console.log(container);
            var url = $(this).attr('data-url');
            AddRow(container, url);
            return false;
        });

        ////add row method
        function AddRow(container, url) {
            debugger;
            var uomConv = 1;
            var CurrencyRateFromBDT = $('.cCurrencyRateFromBDT').val();
            console.log(CurrencyRateFromBDT)
            var cDate = $('.trInvoiceDate').val();
            var Rowtype = $('.cRowtype').val();
            $('#CConversionDate').val(cDate);

            if (Rowtype == "" || Rowtype == null) {
                Rowtype = "New";

                $('.cRowtype').val(Rowtype);

            }

            var model = $('.detailHeadRow :input').serialize();

            var productCode = $('.trProductCode').val();
            var deliveryAddress = $('.cDeliveryAddress').val();
            var tank = $('.cdTankCode').val();
            var mySelect = $('.cItemCode');
            mySelect.append($('<option></option>').val(productCode).html(productCode))


            var productName = $('.trProductName').val();
            var mySelect2 = $('.ccItemCode');
            mySelect2.append($('<option></option>').val(productCode).html(productName))

            var uOMn = $('.trPackSize').val();
            var IsPackCal = $('.trIsPackCal').val();
            var IsFixedVAT = $('.trIsFixedVAT').val();
            model += "&UOMn=" + uOMn;
            model += "&DeliveryAddress=" + deliveryAddress;
            model += "&CConversionDate=" + cDate;
            model += "&CurrencyRateFromBDT=" + CurrencyRateFromBDT;
            model += "&TransactionType=" + '@Model.TransactionType';
            model += "&TankCode=" + tank;
            model += "&IsFixedVAT=" + IsFixedVAT;
            model += "&IsPackCal=" + IsPackCal;
            
            debugger;
            console.log(model);
            $.ajax({
                data: model,
                url: url,
                cache: false,
                success: function (html) {
                    debugger;
                    $("#" + container).append(html);
                    callingFixedTable();
                    SubTotal();
                    NumberFormatCheck();

                    $('.detailHeadRow :input').not('.notClearing').val("");
                    $('.trProduct').select2("val", "");


                }
            });
        }

    </script>

    @*--------------------------add Bank Row and changing product and vehicles--------------------------*@
    <script>

        $('.AddBankRow').on("click", function () {
            debugger;
            var BankId = $('.trBankId').val();
            var instrumentDate = $('.trInstrumentDate').val();
            var amount = $('.cAmount').val();
            if (BankId == "") {
                ShowResult("Fail", "Select Bank First!");
                return;
            }
            if (instrumentDate == "") {
                ShowResult("Fail", "Select Instrument Date!");
                return;
            }
            if (amount == "") {
                ShowResult("Fail", "Amount Required!");
                return;
            }

            var container = $(this).attr('data-container');
            var url = $(this).attr('data-url');
            AddBankRow(container, url);
            return false;
        });

        function AddBankRow(container, url) {
            debugger;
            var model = $('.paymentBankHeadRow :input').serialize();

            var IsUsedDS = $('.trIsUsedDS').val();
            var BankPaymentReceiveId = $('.trBankPaymentReceiveId').val();
            if (IsUsedDS != "true" || IsUsedDS != "false") {
                IsUsedDS = "false";
            }
            var modeOfPayment = $('.trModeOfPayment').val();
            model += "&ModeOfPayment=" + modeOfPayment;
            model += "&IsUsedDS=" + IsUsedDS;
            model += "&BankPaymentReceiveId=" + BankPaymentReceiveId;
            debugger;
            console.log(model);
            $.ajax({
                data: model,
                url: url,
                cache: false,
                success: function (html) {
                    debugger;
                    $("#" + container).append(html);
                    callingFixedBankTable();
                    NumberFormatCheck();
                    PaymentSubTotal();
                    $('.paymentBankHeadRow :input').not('.notClearing').val("");
                    $('.trBankId').select2("val", "");
                    $('.trModeOfPayment').select2("val", "");

                }
            });
        }

    </script>

    @*--------------------------add Bank Row and changing product and vehicles--------------------------*@
    <script>

        $('.AddCreditRow').on("click", function () {
            debugger;
            var crDate = $('.trCRDate').val();
            var amount = $('.cCrAmount').val();
            if (crDate == "") {
                ShowResult("Fail", "Select Credit Date!");
                return;
            }
            if (amount == "") {
                ShowResult("Fail", "Amount Required!");
                return;
            }
            var CRCode = $('.cCRCode').val();

            var count = 0;

            $('.dCRCode').each(function () {
                var existing = $(this).val();
                if (CRCode == existing) {
                    count++;
                }
            });


            if (count > 0) {
                ShowResult("Fail", "CRCode already exists!");
                return;
            }

            var container = $(this).attr('data-container');
            var url = $(this).attr('data-url');
            AddCreditRow(container, url);
            return false;
        });

        function AddCreditRow(container, url, model) {
            debugger;
            //var model = $('.paymentCreditHeadRow :input').serialize();
            debugger;
            console.log(model);
            $.ajax({
                data: model,
                url: url,
                cache: false,
                success: function (html) {
                    debugger;
                    $("#" + container).append(html);
                    callingFixedCreditTable();
                    NumberFormatCheck();
                    CRSubTotal();
                    //$('.paymentCreditHeadRow :input:not(.notClearing, .trNewCRCode, .trNewCRAmount)').val("");

                    //$('.trCRCode').select2("val", "");
                    //$("#EngineInfoTab #popUpTbody").html("");

                }
            });
        }

    </script>



    @*--------------------------for editing and removing a product row--------------------------*@
    <script>
        ////removing all selected row
        function RemoveMultiple() {
            var rows = $('.deleteCheckBox:checkbox:checked');
            if (rows.length == 0) {
                ShowResult("Fail", "Select a row first!");
                return;
            }
            Ask("Are you sure to Delete the item!", function () {
                rows.each(function () {
                    $(this).parents("tr:first").remove();
                });
            });
        }

        $(".cChkExpLoc").change(function () {
            if (this.checked) {
                $('#ChkLoc').text("Export");

            }
            else {
                $('#ChkLoc').text("Local");

            }

            Type();

        });

        $(".trCurrencyId").change(function () {

            var ConversionDate = $(".cConversionDateMaster").val();

            var CFrom = $(".trCurrencyId option:selected").text();
            var CTo = "BDT";
            var currencyBdtId = "260";
            var currencyUsdId = "249";
            console.log(CFrom, CFrom)

            if (CFrom != null && CFrom != "") {
                console.log(CFrom, CTo)

                if (CFrom.toLowerCase() === CTo.toLowerCase()) {

                    $('.cCurrencyRateFromBDT').val('1');

                }
                else {

                    var url = "/Vms/SaleInvoice/SelectCurrencyDetails?ConversionDate=" + ConversionDate;

                    $.getJSON(url, function (data) {

                        $('.cCurrencyRateFromBDT').val(data.CurrencyRate);


                    })
                }

            }

        });

        $(".chkAll").click(function () {
            $('input:checkbox').not(this).prop('checked', this.checked);
        });

        ////edit a row
        function EditItem(sender) {
            debugger;
            var $closestRow = $(sender).closest('.tablerow');
            var itemName = $closestRow.find('.dItemName').val();

            var code = $closestRow.find('.dItemNo').val();
            var NBRPrice = $closestRow.find('.dNBRPrice').val().replace(/\,/g, '');
            var UOMn = $closestRow.find('.dUOMn').val();
            var UOM = $closestRow.find('.dUOM').val();
            var VATRate = $closestRow.find('.dVATRate').val();
            var SDRate = $closestRow.find('.trSDRate').val();
            var Quantity = $closestRow.find('.dQuantity').val();
            var TotalSaleVolume = $closestRow.find('.dTotalSaleVolume').val();
            var UnitPriceWithVAT = $closestRow.find('.dUnitPriceWithVAT').val();

            var ConversionDate = $closestRow.find('.dCConversionDate').val();
            var UOMc = $closestRow.find('.dConvFactor').val();
            var SaleQuantity = $closestRow.find('.dSaleQuantity').val();            
            var tankCode = $closestRow.find('.dTankCode').val();
            var IsFixedVAT = $closestRow.find('.dIsFixedVAT').val();

            $(".cSaleQuantity").val(SaleQuantity);
            $('.trProductName').val(itemName);
            $('.trUnitPriceWithVAT').val(UnitPriceWithVAT);

            var issueDate = $(".trInvoiceDate").val();
            var vatName = $closestRow.find('.dVatName').val(); //// $(".trVAT1Name").val();

            if (code == null || code == "" || code == "null") {
                return;
            }
            $('.cRowtype').val("Change");

            $(".cTotalSaleVolume").val(TotalSaleVolume);
            console.log(TotalSaleVolume)

            var url = "/Vms/SaleMPLInvoice/SelectProductDetails?productCode=" + code + "&IssueDate=" + issueDate + "&vatName=" + vatName;

            $.getJSON(url, function (data) {
                debugger;
                $('.trProductCode').val(data.ProductCode);
                $('.trStock').val(data.Stock);
                $('.trProductName').val(data.ProductName);
                $('.trItemNo').val(data.ItemNo);

                $('.cProductType').val(data.ProductType);

                $('.NBRPrice').val(NBRPrice);
                $('.trNBRPrice').val(NBRPrice);
                $('.trUOM').val(UOM);
                $('.cUOMn').val(UOMn);
                $('.trVATRate').val(VATRate);
                $('.trSDRate').val(SDRate);
                $(".trQuantity").val(Quantity);

                $("#UOMc").val(data.Volume);
                $('.UOMc').val(data.Volume);
                $('.cdTankCode').val(tankCode);
                $('.trIsFixedVAT').val(IsFixedVAT);
                $('.trIsPackCal').val(data.IsPackCal);
                

                LoadcProductCategoryDropDown(data.ProductType, data.CategoryID)
                LoadcProductDropDown(data.CategoryID, data.ProductType, data.ItemNo);

                $(".trType").select2("val", Type);

            })



            $(sender).parents("tr:first").remove();

            SubTotal();

            //LoadUOM(baseUOM, setUOM);

            //function setUOM() {
            //    $(".trPackSize").val(UOM);
            //    GetConvFactor();
            //}

        }

        function EditItem2(sender) {

            var itemName = $(sender).closest('.tablerow_Trackings').find('.ddItemName').val();
            var code = $(sender).closest('.tablerow_Trackings').find('.ddProductCode').val();
            var ItemNo = $(sender).closest('.tablerow_Trackings').find('.ddItemNo').val();
            var Quantity = $(sender).closest('.tablerow_Trackings').find('.ddQuantity').val();
            var UnitPrice = $(sender).closest('.tablerow_Trackings').find('.ddUnitPrice').val();
            //var SubTotal = $(sender).closest('.tablerow').find('.ddSubTotal').val();
            var PartialDescription = $(sender).closest('.tablerow_Trackings').find('.ddPartialDescription').val();

            //$('.trProductName').val(itemName);
            $('.ccItemCode').val(code);

            //$('.trProduct').select2('val', code);
            $('.ccQuantity').val(Quantity);
            $('.ccUnitPrice').val(UnitPrice);
            $('.cPartialDescription').val(PartialDescription);


            var url = "/Vms/DisposeFinish/SelectProductDetails?productCode=" + ItemNo;
            $.getJSON(url, function (data) {

                //$('.trProductCode').val(data.ProductCode);
                //$('.trItemNo').val(data.ItemNo);
                //$('.cProductType').val(data.ProductType);

                //LoadcProductCategoryDropDown(data.ProductType, data.CategoryID)
                //LoadcProductDropDown(data.CategoryID, data.ProductType, data.ItemNo);

            });

            $(sender).parents("tr:first").remove();
            SubTotal();

            $(function () {
                var interval = setInterval(function () {
                    if ($('.trUOM').val() != "") {
                        //UomOptions();
                        //GetConvFactor();
                        clearInterval(interval);
                    }
                }, 200);
            });
        }

        function EditBankItem(sender) {

            var BankId = $(sender).closest('.Banktablerow').find('.dBankId').val();
            var ModeOfPayment = $(sender).closest('.Banktablerow').find('.dModeOfPayment').val();
            var InstrumentNo = $(sender).closest('.Banktablerow').find('.dInstrumentNo').val();
            var InstrumentDate = $(sender).closest('.Banktablerow').find('.dInstrumentDate').val();
            var Amount = $(sender).closest('.Banktablerow').find('.dAmount').val();
            var IsUsedDS = $(sender).closest('.Banktablerow').find('.dIsUsedDS').val();
            var BankPaymentReceiveId = $(sender).closest('.Banktablerow').find('.dBankPaymentReceiveId').val();
            
            //$('.trProductName').val(itemName);
            $('.trBankId').select2('val', BankId);
            $('.trModeOfPayment').select2('val', ModeOfPayment);

            $('.trInstrumentNo').val(InstrumentNo);
            $('.trInstrumentDate').val(InstrumentDate);
            $('.cAmount').val(Amount);
            $('.trIsUsedDS').val(IsUsedDS);
            $('.trBankPaymentReceiveId').val(BankPaymentReceiveId);


            $(sender).parents("tr:first").remove();
            PaymentSubTotal();
            $(function () {
                var interval = setInterval(function () {
                    if ($('.trUOM').val() != "") {

                        clearInterval(interval);
                    }
                }, 200);
            });
        }

        function EditCRItem(sender) {

            var CRCode = $(sender).closest('.crtablerow').find('.dCRCode').val();
            var CRDate = $(sender).closest('.crtablerow').find('.dCRDate').val();
            var Amount = $(sender).closest('.crtablerow').find('.dAmount').val();
            var SalesInvoiceMPLHeaderId = $(sender).closest('.crtablerow').find('.dSalesInvoiceMPLHeaderId').val();

            $('.cCRCode').val(CRCode);
            $('.cCRAmount').val(Amount);
            $('.trCRDate').val(CRDate);
            $('.trSalesInvoiceMPLHeaderId').val(SalesInvoiceMPLHeaderId);



            $(sender).parents("tr:first").remove();
            CRSubTotal();
            $(function () {
                var interval = setInterval(function () {
                    if ($('.trUOM').val() != "") {

                        clearInterval(interval);
                    }
                }, 200);
            });
        }


        $("#EngineInfoTab #btnAdd").on("click", function () {

            var ItemNo = $("#Sale .trItemNo").val()
            var TransactionType = '@Model.TransactionType';

            if (ItemNo == "" || ItemNo == null) {
                ShowResult("Fail", "Please Select Product First !");
                return;
            }
            var SalesInvoiceNo = $("#Sale .trSalesInvoiceNo").val();

            var ProductCode = $("#Sale .trProductCode").val();
            var CompanyCode = $("#Sale .trSalesInvoiceNo").val();

            var url = "/Vms/SaleInvoice/AddEngine?ItemNo=" + ItemNo + "&SalesInvoiceNo=" + SalesInvoiceNo + "&ProductCode=" + ProductCode + "&TransactionType=" + TransactionType;


            modalInit(url);
        });
        $("#EngineInfoTab #btnRemoveEngine").on("click", function () {


            var questionMSG = "Are you sure to Remove Data!";
            Ask(questionMSG, function () {

                RemoveEngine();

            });

        });

        $("#EngineInfoTab #btnChange").on("click", function () {

            var questionMSG = "Are you sure to Change Total Qunatity!";
            Ask(questionMSG, function () {

                var $Items = $("#EngineInfoTab .dSelected:input:checkbox:not(:checked)");
                var totalQty = $Items.length;
                $(".trQuantity").val(totalQty);
            });


        });

        function SearchEngine() {
            var model = {
                ItemNo: $("#Sale .trItemNo").val()
            , SalesInvoiceNo: $("#Sale .trSalesInvoiceNo").val()
            }

            $.ajax({
                data: model
            , url: "/Vms/SaleInvoice/GetEngine_ACI"
            , cache: false
            , traditional: true
            , type: "POST"
            , beforeSend: function () { $(".loading").show(); }
            , success: function (html) {
                $("#EngineInfoTab #popUpTbody").html("");
                $("#EngineInfoTab #popUpTbody").html(html);

            }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            });
        }
        function RemoveEngine() {


            IDs = [];


            var $Items = $("#EngineInfoTab .dSelected:input:checkbox:checked");
            if ($Items == null || $Items.length == 0) {
                ShowResult("Fail", "You are requested to Select before Remove!");
                return;
            }
            var Post = $("#Post").val();

            if (Post.toLowerCase() == 'true' || Post.toLowerCase() == 'y') {
                ShowResult("Fail", "Data Already Posted. Can't Remove!");
                return;
            }

            $Items.each(function () {

                var SalesInvoiceNo = $(this).closest('tr').find('.SalesInvoiceNo').text();
                var ItemNo = $(this).closest('tr').find('.ItemNo').text();
                var EngineNumber = $(this).closest('tr').find('.EngineNumber').text();
                var ChassisNumber = $(this).closest('tr').find('.ChassisNumber').text();


                if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    return;
                }
                item = {}
                item["SalesInvoiceNo"] = SalesInvoiceNo;
                item["ItemNo"] = ItemNo;
                item["EngineNumber"] = EngineNumber;
                item["ChassisNumber"] = ChassisNumber;

                IDs.push(item);

            });


            var model = {
                IDs: IDs
            }
            console.log(model)
            var url = '/VMS/SaleInvoice/MultipleEngineRemove';


            $.ajax({
                url: url
            , data: JSON.stringify(model)
            , type: 'Post'
            , traditional: true
            , beforeSend: function () { $(".loading").show(); }
            , success: function (rVM) {
                ShowResult(rVM.Status, rVM.Message);

                if (rVM.Status == "Success") {
                    SearchEngine();
                }
            }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            , contentType: 'application/json; charset=utf-8'
            , dataType: 'json'

            });

        }

        function SaveEngine() {


            IDs = [];


            var $Items = $("#EngineInfoTab .dSelected:input:checkbox:checked");
            if ($Items == null || $Items.length == 0) {
                ShowResult("Fail", "You are requested to Select before Remove!");
                return;
            }
            var Post = $("#Post").val();

            if (Post.toLowerCase() == 'true' || Post.toLowerCase() == 'y') {
                ShowResult("Fail", "Data Already Posted. Can't Remove!");
                return;
            }

            $Items.each(function () {

                var SalesInvoiceNo = $(this).closest('tr').find('.SalesInvoiceNo').text();
                var ItemNo = $(this).closest('tr').find('.ItemNo').text();
                var EngineNumber = $(this).closest('tr').find('.EngineNumber').text();
                var ChassisNumber = $(this).closest('tr').find('.ChassisNumber').text();


                if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    return;
                }
                item = {}
                item["SalesInvoiceNo"] = SalesInvoiceNo;
                item["ItemNo"] = ItemNo;
                item["EngineNumber"] = EngineNumber;
                item["ChassisNumber"] = ChassisNumber;

                IDs.push(item);

            });


            var model = {
                IDs: IDs
            }

            var url = '/VMS/SaleInvoice/MultipleEngineRemove';


            $.ajax({
                url: url
            , data: JSON.stringify(model)
            , type: 'Post'
            , traditional: true
            , beforeSend: function () { $(".loading").show(); }
            , success: function (rVM) {
                ShowResult(rVM.Status, rVM.Message);

                if (rVM.Status == "Success") {
                    SearchEngine();
                }
            }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            , contentType: 'application/json; charset=utf-8'
            , dataType: 'json'

            });

        }


        ////removing a row
        function RemoveItem(sender) {
            debugger;
            Ask("Are you sure to Delete the item!", function () {
                $(sender).parents("tr:first").remove();
                SubTotal();
            });
        }
        function RemoveBankItem(sender) {
            debugger;
            Ask("Are you sure to Delete the item!", function () {
                $(sender).parents("tr:first").remove();
                PaymentSubTotal();
            });
        }
        function RemoveCRItem(sender) {
            debugger;
            Ask("Are you sure to Delete the item!", function () {
                $(sender).parents("tr:first").remove();
                CRSubTotal();
            });
        }
    </script>

    @*--------------------------for subtotal and save method--------------------------*@
    <script>
        function OtherTotal() {
            var TotalAmount = 0;
            debugger;

            var SupplyVAT = $(".cVATTotal").val();
            var TC = $(".cTC").val();
            var LF = $(".cLF").val();
            var SC = $(".cSC").val();
            var ShortExcessAmnt = $(".cShortExcessAmnt").val();
            var Toll = $(".cToll").val();
            var ATV = $(".cATV").val();
            var DC = $(".cDC").val();
            var RF = $(".cRF").val();
            var LessFrightToPay = $(".cLessFrightToPay").val();
            var OtherAmnt = $(".cOtherAmnt").val();
            console.log(OtherAmnt)

            TotalAmount = parseFloat(SupplyVAT) + parseFloat(TC) + parseFloat(LF) + parseFloat(SC) + parseFloat(ShortExcessAmnt) + parseFloat(Toll) + parseFloat(ATV) + parseFloat(DC) + parseFloat(RF) + parseFloat(LessFrightToPay) + parseFloat(OtherAmnt);
            TotalAmount = TotalAmount.toFixed(2);
            $(".cOtherTotalAmnt").val(TotalAmount);
            SubTotal();


        }
        function SubTotal() {
            debugger;
            var TotalAmount = 0;

            var OtherTotalAmnt = $(".cOtherTotalAmnt").val();

            $(".tablerow").each(function () {
                var dTotalAmountElement = $(this).find(".dTotalAmount");

                if (dTotalAmountElement.length > 0) {
                    TotalAmount += parseFloat(dTotalAmountElement.val().replace(/\,/g, ''));
                }


            });

            GrandTotal = TotalAmount + parseFloat(OtherTotalAmnt);

            GrandTotal = parseFloat(GrandTotal).toFixed(2);


            $(".cGrandTotal").val(GrandTotal);
            NewCRSubTotal();

        }

        function PaymentSubTotal() {
            debugger;
            var TotalAmount = 0;


            $(".Banktablerow").each(function () {
                var dAmount = $(this).find(".dAmount");

                if (dAmount.length > 0) {
                    TotalAmount += parseFloat(dAmount.val().replace(/\,/g, ''));
                }



            });

            GrandTotal = TotalAmount;

            GrandTotal = parseFloat(GrandTotal).toFixed(2);


            $(".cTotalPaymentAmnt").val(GrandTotal);

            NewCRSubTotal();

        }

        function CRSubTotal() {
            debugger;
            var TotalAmount = 0;



            $(".crtablerow").each(function () {
                var dAmount = $(this).find(".dAmount");

                if (dAmount.length > 0) {
                    TotalAmount += parseFloat(dAmount.val().replace(/\,/g, ''));
                }

            });

            GrandTotal = TotalAmount;
            GrandTotal = parseFloat(GrandTotal).toFixed(2);

            $(".cTotalCRAmnt").val(GrandTotal);
            NewCRSubTotal();
        }
        function NewCRSubTotal() {
            debugger;
            var TotalAmount = 0;


            var LessFrightToPay = $(".cGrandTotal").val()
            var TotalPaymentAmnt = $(".cTotalPaymentAmnt").val()
            var TotalCRAmntAmnt = $(".cTotalCRAmnt").val()


            GrandTotal = (parseFloat(TotalPaymentAmnt) + parseFloat(TotalCRAmntAmnt)) - parseFloat(LessFrightToPay);

            GrandTotal = parseFloat(GrandTotal).toFixed(2);

            $(".trNewCRAmount").val(GrandTotal);

        }

        function SaveData() {
            debugger;
            var Post = $("#Post").val();
            if (Post.toLowerCase() == 'true' || Post.toLowerCase() == 'y') {
                ShowResult("Fail", "Data Already Posted. Can't Update!");
                return;
            }

            var a = requiredFields('frmSaleInvoice');


            var cCustomerName = $(".trCustomerId").val();
            console.log(cCustomerName)
            if (cCustomerName == "" || cCustomerName == null || cCustomerName == "0") {
                ShowResult("Fail", "Please Select Customer!");
                return;
            }



            var SerialNo = $('.cSerialNo').val();


            var items = $(".dItemName").length;
            if (items == 0) {
                ShowResult("Fail", "Please Add Product Details!");
                $(".accordionProduct").trigger("click");
                return;
            }

            if (a != 0) {
                return;
            }

            pageSubmit('frmSaleInvoice');
        }
    </script>

    @*--------------------------for post method--------------------------*@
    <script>
        function PostData() {
            debugger;
            var Id = $("#Id").val();
            var Post = $("#Post").val();
            if (Post.toLowerCase() == 'true' || Post.toLowerCase() == 'y') {
                ShowResult("Fail", "Data Already Posted!");
                return;
            }
            var branchId = '@Session["BranchId"]';
            var searchBranchId = $('#BranchId').val();
            if (branchId != searchBranchId) {
                ShowResult("Fail", "This Information not for this Branch!");
                return;
            }

            var questionMSG = "Are you sure to Post Data!";

            Ask(questionMSG, function () {
                debugger;
                var model = {
                    IDs: Id,
                }
                debugger;
                var url = '/VMS/SaleMPLInvoice/MultipleSalePost';

                $.ajax({
                    url: url
                    , data: model
                    , type: 'Post'
                    , traditional: true
                    , beforeSend: function () { $(".loading").show(); }
                    , success: function (rVM) {
                        debugger;
                        ShowResult("Success", rVM);
                        $("#Post").val('Y');
                    }
                    , complete: function () { $(".loading").fadeOut(200).hide("slow") }

                });
            });
        };

    </script>

    @*--------------------------fixed header column table--------------------------*@
    <script>
        function fixedScrolltrkFixedTable(tableId, leftTotal) {
            $('#' + tableId + ' tbody').scroll(function (e) {
                var i;
                var j = 2;
                for (i = 1; i <= leftTotal; i++) {
                    $('#' + tableId + ' tbody td:nth-child(' + i + ')').css("z-index", "1");
                    $('#' + tableId + ' thead th:nth-child(' + i + ')').css("left", $("#" + tableId + " tbody").scrollLeft());

                    $('#' + tableId + ' tbody td:nth-child(' + j + ')').css("z-index", "1");
                    $('#' + tableId + ' tbody td:nth-child(' + j + ')').css("left", $("#" + tableId + " tbody").scrollLeft());
                    $('#' + tableId + ' tbody td:nth-child(' + j + ')').css("left", $("#" + tableId + " tbody").scrollLeft());
                    j++;
                }
                $('#' + tableId + ' thead').css("left", -$("#" + tableId + " tbody").scrollLeft());
                //$('#' + tableId + ' thead th:nth-child(2)').css("left", $("#" + tableId + " tbody").scrollLeft());

            });
        }
        function settingtrkFixedColumnWidth(tableId, widthArgs) {
            if (widthArgs == null) {
                return;
            }
            var i;
            var j = 2;
            for (i = 1; i <= widthArgs.length; i++) {
                $('#' + tableId + ' tr td:nth-child(' + j + ')').css("min-width", widthArgs[i - 1] + "px");
                $('#' + tableId + ' tr th:nth-child(' + i + ')').css("min-width", widthArgs[i - 1] + "px");
                j++;
            }
        }
        function fixLeftColumns(tableId, leftTotal) {
            var i;
            var j = 2;
            for (i = 1; i <= leftTotal; i++) {
                //fixed column header style
                $('#' + tableId + ' thead th:nth-child(' + i + ')').css("height", "20px");
                $('#' + tableId + ' thead th:nth-child(' + i + ')').css("position", "relative");
                $('#' + tableId + ' thead th:nth-child(' + i + ')').css("z-index", "2");
                //fixed column rows style
                $('#' + tableId + ' tbody tr td:nth-child(' + j + ')').css("height", "20px");
                $('#' + tableId + ' tbody tr td:nth-child(' + j + ')').css("position", "relative");
                j++;
            }
        }
        function settingWidth(tableId) {
            var parentWidth = $('#' + tableId).closest('.fixedParent').width();
            $('#' + tableId + ' thead').width(parentWidth);
            $('#' + tableId + ' tbody').width(parentWidth);
        }


        function trkFixedTable(tableId, leftTotal, args) {
            debugger;
            settingWidth(tableId);
            fixLeftColumns(tableId, leftTotal);
            fixedScrolltrkFixedTable(tableId, leftTotal);
            settingtrkFixedColumnWidth(tableId, args);
        }
        function callingFixedTable() {
            var args = [150, 200, 150, 100, 100, 100, 150, 150, 100, 100, 100, 100, 150, 150, 100, 100, 150, 150, 100, 100, 150, 100, 100, 100, 100, 100, 100, 100, 100, 150, 200, 150, 150, 150, 150, 150, 150, 150, 150, 100];
            trkFixedTable("itemTable", 3, args);
        }

        function callingFixedBankTable() {
            var args = [150, 200, 250, 200, 220, 160, 220, 150, 200, 150, 150, 200, 150, 150, 100, 100, 150, 150, 100, 100, 150, 100, 100, 100, 100, 100, 100, 100, 100, 150, 200, 150, 150, 150, 150, 150, 150, 150, 150, 100];
            trkFixedTable("itemBankTable", 1, args);
        }

        function callingFixedCreditTable() {
            var args = [200, 200, 200, 200];
            trkFixedTable("itemCreditTable", 3, args);
        }
        $(function () {
            callingFixedTable();
            callingFixedBankTable();
            callingFixedCreditTable();
        })


    </script>

    @*--------------------------for navigation--------------------------*@
    <script>
        function navigatePage() {
            var interval = setInterval(function () {
                if (document.querySelectorAll('.trNavigateMenu option').length > 0) {
                    var id = '@Model.Id';
                    $('.trNavigateMenu').select2("val", id);
                    clearInterval(interval);
                }
            }, 200);
            ////navigating previous-next
            $('.changePage').click(function () {
                var id = '@Model.Id';
                var ttype = '@Model.TransactionType';
                var btn = $(this).attr("data-pager-action");
                if (btn.toLocaleLowerCase() == "current") {
                    var targetId = $('.trNavigateMenu').val();
                    if (id == targetId) {
                        return;
                    }
                    id = targetId;
                }
                window.location = "/VMS/SaleInvoice/Navigate?id=" + id + "&btn=" + btn + "&ttype=" + ttype;
            });
        }
    </script>

    @*for showing product details and toggle accordion*@
    <script>
        function showProductDetail() {
            var productDetail = document.getElementById('productDetails');
            $(document).on("dblclick", '.tablerow', function () {
                var code = $(this).find('input.dItemNo').val();
                var url = "/Vms/Product/ShowProduct?code=" + code;
                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    complete: function () { $(".loading").fadeOut(200).hide("slow") },
                    success: function (html) {
                        productDetail.style.display = "block";
                        $(".trkmodal-content").html(html);
                    }
                });
            });
        }
    </script>
<script>

    $('#btnPaymentReceiveList').click(function () {
        var CustomerId = $('.trCustomerId :selected').val();

        if (CustomerId == null || CustomerId == "") {
            ShowResult("Fail", "Please Select Customer First!");
            return;
        }
        debugger;


        var url = "/Vms/MPLBankPaymentReceive/GetBankPaymentReceivePopUp?CustomerId=" + CustomerId;
        var modal = document.getElementById('myHigherModal');
        $.ajax({
            url: url,
            cache: false,
            beforeSend: function () { $(".loading").show(); },
            success: function (html) {
                debugger;
                modal.style.display = "block";
                $("#myHigherModal").html(html);
            }
        , complete: function () { $(".loading").fadeOut(200).hide("slow") }
        });
    });
   

    function ShowModal() {
        debugger;
       
    };
    </script>
    @*Initial function*@
    <script>
        $(function () {
            debugger;
            valiDation("frmSaleInvoice");

            Type();


            $('.customDatePicker').prop("readonly", false);
            ////for navigation

            var operation = '@Model.Operation';

            if (operation == "update") {
                debugger;

                navigatePage();

                @*////CustomerSelect('@Model.CustomerID');*@

                $('.trCustomerId').select2('data', { id: '@Model.CustomerID', text: '@Model.CustomerName' });


            }

            setCABalance();

            SubTotal();
            PaymentSubTotal();
            CRSubTotal();
            ////for counting discount amount based on % symbol
            MyToggleBox('discountType');

            ////initializing modal
            //showProductDetail();
            debugger;
            /////closing modal
            window.onclick = function (event) {

                var productDetail = document.getElementById('productDetails');

                if (event.target == productDetail) {
                    $(".trkmodal-content").html("");
                    productDetail.style.display = "none";
                }
                //var modal = document.getElementById('myModal');
                //if (event.target == modal) {
                //    $("#myModal").html("");
                //    modal.style.display = "none";
                //}
            }

        });

    

    function VehicleSelect(VehicleType) {
        debugger;
        $('.trVehicleType').val("");

        @*var value = '@Model.CustomerID';*@

        var value = VehicleType;

        var VehicleType = "";
        var url = "";
        url = "/Config/DropDown/EnumVehicleType";
        VehicleType += "<option value=0>Select</option>";
        $.getJSON(url, function (data) {
            debugger;
            $.each(data, function (i, state) {
                VehicleType += "<option value='" + state.Value + "'>" + state.Text + "</option>";
            });

            $('.trVehicleType').html(VehicleType);

            $('.trVehicleType').select2('data', { id: '@Model.VehicleType', text: '@Model.VehicleType' });

        });
    };

</script>



    @*for calculating discount*@
    <script>
        $(function () {
            $('.discountType').click(function () {
                setTimeout(function () {
                    calculateDiscount();
                }, 500);
            });
            $(".trDiscount").blur(function () {
                calculateDiscount();
            });
        })
        function calculateDiscount() {
            var status = $('#discountType').val();
            var nbrprice = parseFloat($('.NBRPrice').val().replace(/\,/g, ''));
            var discount = parseFloat($('.trDiscount').val().replace(/\,/g, ''));
            if (isNaN(discount)) {
                discount = 0;
            }
            if (isNaN(nbrprice)) {
                nbrprice = 0;
            }
            var disountedNBRPrice = 0;
            if (status == 'True') {
                disountedNBRPrice = nbrprice - (nbrprice * discount / 100);
            }
            else {
                disountedNBRPrice = nbrprice - discount;
            }
            if (disountedNBRPrice < 0) {
                ShowResult("Fail", "Discount can't be greater than price!");
                $('.trNBRPrice').val(nbrprice);
                $('.trDiscount').val("0");
                return;
            }
            $('.trNBRPrice').val(disountedNBRPrice);
        }
    </script>

    @*for setting products and ca balance*@
    <script>
        ////Setting C.A Balance
        function setCABalance() {
            var interval = setInterval(function () {
                var challanDate = $('.trInvoiceDate').val();
                if (challanDate != "") {
                    var url = "/Vms/SaleInvoice/getCABalance?startDate=" + challanDate;
                    $.getJSON(url, function (data) {
                        $('.trTDBalance').val(data);
                    });
                    clearInterval(interval);
                }
            }, 500);

        }
    </script>

    @*--------------------------MISC Functions--------------------------*@
    <script>

        ////Getting uom conversion
        function GetConvFact() {

            //////alert(3);
            var uomConv = 1;
            var uomFrom = $('.trUOM').val();
            var uomTo = $('.trPackSize').val();
            if (uomFrom != uomTo) {
                uomConv = $('#ConvFactor').val();
            }
            return uomConv;
        }
        //OtherTotal Change Calculation
        $(function () {

            var SupplyVAT = $(".cVATTotal").val();
            var TC = $(".cTC").val();
            var LF = $(".cLF").val();
            var SC = $(".cSC").val();
            var ShortExcessAmnt = $(".cShortExcessAmnt").val();
            var Toll = $(".cToll").val();
            var ATV = $(".cATV").val();
            var DC = $(".cDC").val();
            var RF = $(".cRF").val();
            var LessFrightToPay = $(".cLessFrightToPay").val();

            $('.cVATTotal').change(function () {
                OtherTotal();
            });

            $('.cTC').change(function () {
                OtherTotal();
            });

            $('.cLF').change(function () {
                OtherTotal();
            });

            $('.cShortExcessAmnt').change(function () {
                OtherTotal();
            });

            $('.cToll').change(function () {
                OtherTotal();
            });

            $('.cATV').change(function () {
                OtherTotal();
            });

            $('.cDC').change(function () {
                OtherTotal();
            });

            $('.cRF').change(function () {
                OtherTotal();
            });
            $('.cSC').change(function () {
                OtherTotal();
            });
            $('.cLessFrightToPay').change(function () {
                OtherTotal();
            });
            $('.cOtherAmnt').change(function () {
                OtherTotal();
            });
        });
        ////changing vehicle
        //$(function () {
        //    $('.trVehicle').change(function () {
        //        vehicleChange();
        //    });
        //});

        ////vehicle change method
        function vehicleChange() {

            var vehicleId = $('.trVehicle :selected').val();

            var VehicleNo = $('#IdVehicleNo').val();

            if (VehicleNo == null || VehicleNo == "") {
                return;
            }
            $('#VehicleID').val("");
            $('.cVehicleType').val("");

            //if (vehicleId == null || vehicleId == "") {
            //    return;
            //}
            var url = "/Vms/SaleInvoice/getVehicleDetails?vehicleId=" + VehicleNo;
            $.getJSON(url, function (data) {

                $('#VehicleID').val(data.VehicleID);
                $('.cVehicleType').val(data.VehicleType);

            });
        }

        ////product category change method
        function ProductGroupChange() {
            $('.trProductName').val("");
            var value = $('#ItemGroup').val().toString();
            var productNames = "";

            var url = "/Config/DropDown/DropDownProductByCategory/?id=" + value;
            productNames += "<option value=0>Select</option>";
            $.getJSON(url, function (data) {
                $.each(data, function (i, state) {
                    productNames += "<option value='" + state.Value + "'>" + state.Text + "</option>";
                });

                $('.trProductName').html(productNames);
            });
        }

        ////product change method
        function ProductNameChange(code, ItemEdit) {

            var issueDate = $(".trInvoiceDate").val();
            var vatName = $(".trVAT1Name").val();
            if (code == null || code == "" || code == "null") {
                return;
            }

            var url = "/Vms/SaleMPLInvoice/SelectProductDetails?productCode=" + code + "&IssueDate=" + issueDate + "&vatName=" + vatName;
            $.getJSON(url, function (data) {
                $('.trProductCode').val(data.ProductCode);
                $('.trStock').val(data.Stock);
                $('.trHSCode').val(data.HSCodeNo);

                //trProductDescription
                $('.trUnitPriceWithVAT').val(data.SalesPrice);
                $('.trUOM').val(data.UOM);
                $('.trProductName').val(data.ProductName);
                $('.trSDRate').val(data.SD);
                $('.trItemNo').val(data.ItemNo);
                $('.UOMc').val(data.Volume);
                $('.cUOMn').val(data.VolumeUnit);
                $('.trUOM').val(data.UOM);
                $('#UOMc').val(data.Volume);
                $('#PkgSize').val(data.PackSize);
                $('.trIsPackCal').val(data.IsPackCal);
                
                console.log(data.Volume)
                if (data.IsRaw.toLowerCase() === "trading") {

                    $('.trVATRate').val(data.TradingSaleVATRate);
                    $('.trSDRate').val(data.TradingSaleSD);

                }
                debugger;

                if (data.IsFixedVAT.toLowerCase() === "y") {

                    $('.trVATRate').val(data.FixedVATAmount);
                    var nbrprice = parseFloat(data.SalesPrice)-parseFloat(data.FixedVATAmount)
                    nbrprice = parseFloat(nbrprice).toFixed(2);

                    $('.trNBRPrice').val(nbrprice);
                    $('.trIsFixedVAT').val(data.IsFixedVAT);

                }
                else
                {
                    $('.trVATRate').val(data.VATRate);

                    var nbrprice = parseFloat(data.SalesPrice) * 100 / (100 + parseFloat(data.FixedVATAmount))
                    nbrprice = parseFloat(nbrprice).toFixed(2);
                    $('.trNBRPrice').val(nbrprice);
                    $('.trIsFixedVAT').val(data.IsFixedVAT);

                }

                BOMReferenceNoLoad();

                NumberFormatCheck();

                var vVatRate = $('.trVATRate').val();
                //var html = "<option value=" + data.UOM + ">" + data.UOM + "</option>";
                //$('#PackSize').html(html);


            });

        }

        ////changing product
        $(function () {
            $('.trProduct').change(function () {
                var Productname = $('.trProduct :selected').text();

                $('.trProductDescription').val(Productname);

                var productCode = $(this).val();


                $('#ProductDescription').attr('data-code', productCode); //setter

                if (productCode == "") {
                    return;
                }

                ProductNameChange(productCode);

                $(function () {
                    var interval = setInterval(function () {

                        BOMReferenceNoChange();

                        if ($('.trUOM').val() != "") {

                            UomOptions();

                            clearInterval(interval);
                        }
                    }, 200);
                });

            });
        })


        function BOMReferenceNoLoad(BOMReferenceNo) {
            var ItemNo = $(".trItemNo").val();
            var VatName = $(".trVAT1Name").val();
            var EffectDate = $(".trInvoiceDate").val();
            var CustomerID = $(".trCustomerId").val();

            var url = "/Config/DropDown/DropDownBOMReferenceNo";
            url = url + "?" + "ItemNo=" + ItemNo
            + "&VatName=" + VatName
            + "&EffectDate=" + EffectDate
            + "&CustomerID=" + CustomerID;


            var $Dropdown = $(".cBOMReferenceNo");

            DropdownLoad($Dropdown, url, BOMReferenceNo);

        }


        ////changing uom to/packet size
        //$('.trPackSize').change(function () {

        //    GetConvFactor();
        //});
        $('.cSaleQuantity').change(function () {
            var ConvFactor = $('#UOMc').val();
            var SaleQuantity = $('.cSaleQuantity').val();
            console.log(ConvFactor)
            console.log(SaleQuantity)
            var TotalSaleVolume = parseFloat(SaleQuantity) * parseFloat(ConvFactor)
            $('.cTotalSaleVolume').val(TotalSaleVolume);

        });


        ////uom conversion method


        ////uom option method
        function UomOptions() {
            var uom = $('.trUOM').val();
            var url = "/Vms/SaleInvoice/GetUomOption?uomFrom=" + uom;
            $.ajax({
                url: url,
                cache: false,
                success: function (uoms) {

                    var html = "";

                    if (uoms == null || uoms.length === 0) {
                        html += "<option value='" + uom + "'>" + uom + "</option>";
                    }
                    else {
                        html += "<option value='" + uom + "'>" + uom + "</option>";

                        uoms.forEach(function (item) {
                            html += "<option value='" + item.UOMTo + "'>" + item.UOMTo + "</option>";
                        });
                    }

                    $('#PackSize').html(html);
                }
            });
        }
        ////uom option method
        function LoadUOM(uom, callBack) {
            //var uom = $('.trUOM').val();
            var url = "/Vms/SaleInvoice/GetUomOption?uomFrom=" + uom;
            $.ajax({
                url: url,
                cache: false,
            }).done(function (uoms) {

                var html = "";

                if (uoms == null || uoms.length === 0) {
                    html += "<option value='" + uom + "'>" + uom + "</option>";
                }
                else {
                    html += "<option value='" + uom + "'>" + uom + "</option>";

                    uoms.forEach(function (item) {
                        html += "<option value='" + item.UOMTo + "'>" + item.UOMTo + "</option>";
                    });
                }

                $('#PackSize').html(html);

                if (callBack) {
                    callBack();
                }
            })
        }

    </script>

    @*--------------------------Modal--------------------------*@

    <script>
        $(function () {

            function modalInit(url) {
                var modal = document.getElementById('myModal');
                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    complete: function () { $(".loading").fadeOut(200).hide("slow") },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myModal").html(html);
                    }
                });
            }

            $('.ProductDsc').click(function () {
                var url = "/VMS/SaleInvoice/ProductDscripition";

                modalInit(url);
            });

        });
    </script>

    @*calling higher products modal*@

    <script>

        function modalInitHigher(url) {

            var ProductType = $(".cProductType :selected").val();
            var ProductCategoryId = $(".cProductCategoryId :selected").val();
            var ProductCategory = $(".cProductCategoryId :selected").text();

            url = url
            + "&ProductType=" + ProductType
            + "&ProductCategoryId=" + ProductCategoryId
            + "&ProductCategory=" + ProductCategory
            ;

            var modal = document.getElementById('myHigherModal');
            $.ajax({
                url: url,
                cache: false,
                beforeSend: function () { $(".loading").show(); },
                success: function (html) {
                    modal.style.display = "block";
                    $("#myHigherModal").html(html);
                }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            });
        }

        function callbackFromProductModal(sender) {
            var code = $(sender).children('td.popUpItemCode').text();
            var itemNo = $(sender).children('td.popUpItemNo').text();
            $('.trProductCode').val(code);
            $('.trItemNo').val(itemNo);
            ProductNameChange(code);
            //$('.trProduct').select2('val', code);
            $('.trProduct').select2('val', itemNo);

            $(function () {
                var interval = setInterval(function () {
                    if ($('.trUOM').val() != "") {

                        UomOptions();

                        clearInterval(interval);
                    }
                }, 200);
            });
        }
        function callbackPaymentReceiveModal(productData) {

            var container = "editorItemRows5";
            var url = "/Vms/SaleMPLInvoice/BankPayment";

            var BankName = productData.BankName;
            var ModeOfPayment = productData.ModeOfPayment;
            var InstrumentNo = productData.InstrumentNo;
            var InstrumentDate = productData.InstrumentDate;
            var Amount = productData.Amount;
            var IsUsedDS = productData.IsUsedDS;
            var BankId = productData.BDBankId;
            var Id = productData.Id;
        
            var model = {
                BankPaymentReceiveId: Id,
                BankId: BankId,
                BankName: BankName,
                ModeOfPayment: ModeOfPayment,
                InstrumentNo: InstrumentNo,
                InstrumentDate: InstrumentDate,
                Amount: Amount,
                IsUsedDS: IsUsedDS === "Y" ? "true" : "false"
            };
            debugger;
            console.log(model);


            var InstrumentNo = InstrumentNo;

            var count = 0;

            $('.dInstrumentNo').each(function () {
                var existing = $(this).val();
                if (InstrumentNo == existing) {
                    count++;
                }
            });


            if (count > 0) {
                ShowResult("Fail", "This already exists!");
                return;
            }
            $.ajax({
                data: model,
                url: url,
                cache: false,
                success: function (html) {
                    debugger;
                    $("#" + container).append(html);
                    callingFixedBankTable();
                    NumberFormatCheck();
                    PaymentSubTotal();
                   

                }
            });
        }
        function redirectToSaleWithId(refNo) {

            window.location = "/VMS/SaleInvoice/SelectSale?refNo=" + refNo;
        }

        

        function callbackFromCRModal(CRCode, CRAmount, CRDate, CRSalesInvoiceMPLHeaderId) {


            console.log(CRSalesInvoiceMPLHeaderId)

            $('.cCRCode').val(CRCode);
            $('.cCRAmount').val(CRAmount);
            $('.trCRDate').val(CRDate);
            $('.trSalesInvoiceMPLHeaderId').val(CRSalesInvoiceMPLHeaderId);


        }


        function callbackFromCustomerAddressModal(sender) {
            var CustomerAddress = $(sender).children('td.popUpCustomerAddress').text();
            $('.cDeliveryAddress').val(CustomerAddress);

        }

        function callbackFromCustomHouseModal(sender) {
            var CustomName = $(sender).children('td.popUpCustomsHouseName').text();
            var CustomCode = $(sender).children('td.popUpCustomHouseCode').text();

            //$('.cCustomHouse').select2('val', CustomHouse);
            $('.cCustomName').val(CustomName);
            $('.cCustomCode').val(CustomCode);
        }

        $(function () {

            $('#productBtn').click(function () {
                var productCode = $('.trProduct').val();
                var ItemNo = $('.trItemNo').val();
                debugger;


                var url = "/Vms/Product/GetProductPopUp?targetId=ProductName&ProductCode=" + productCode;

                modalInitHigher(url);
            });

            $('#saleIntegration').click(function () {

                var url = "/Vms/SaleInvoice/GetSaleIntegration";

                var modal = document.getElementById('myHigherModal');
                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myHigherModal").html(html);
                    }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                });

            });

            //1



            @*$('#CrBtn').click(function () {
                debugger;
                var customerName = $('.trCustomerId option:selected').text();
                if (customerName.indexOf("SelectSelect") !== -1) {
                    debugger;
                    customerName = "";
                }
                if (customerName === "Select" || customerName === "N/A") {

                    ShowResult("Fail", "Please Select Customer First!");
                    return;
                }
                var customerId = $('.trCustomerId option:selected').val();

                var url = "/Vms/SaleMPLInvoice/GetCRInfoPopUp?CustomerId=" + customerId + "&SalesInvoiceMPLHeaderId=" + '@Model.Id';
                var modal = document.getElementById('myHigherModal');
                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myHigherModal").html(html);
                    }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                });
            });*@

        });

        $(function () {
            $('#productDescriptionBtn').click(function () {
                var productCode = $('.trProductCode').val();
                if (productCode === "") {
                    ShowResult("Fail", "Please Select Procduct First! ");
                    return;
                }
                var url = "/Vms/Product/GetProductNamesPopUp?targetId=ProductName&ProductCode=" + productCode;

                modalInitHigher(url);
            });

            //$('#customerBtn').click(function () {
            //    var customerName = $('.trCustomerId option:selected').text();
            //    var url = "/Vms/Customer/GetCustomerPopUp?CustomerName=" + customerName;
            //    var modal = document.getElementById('myHigherModal');
            //    $.ajax({
            //        url: url,
            //        cache: false,
            //        beforeSend: function () { $(".loading").show(); },
            //        success: function (html) {
            //            modal.style.display = "block";
            //            $("#myHigherModal").html(html);
            //        }
            //    , complete: function () { $(".loading").fadeOut(200).hide("slow") }
            //    });
            //});



            $('#btnEXPFormNo').click(function () {

                ///
                var url = "/Vms/SaleInvoice/GetEXPFormNoPopUp";
                //console.log(url)
                //modalInitHigher(url);

                var modal = document.getElementById('myHigherModal');

                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myHigherModal").html(html);
                    }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }

                });


            });

            $('#SearchEXPbtn').click(function () {

                ///
                var url = "/Vms/SaleInvoice/PopUpGetEXP";
                //console.log(url)
                //modalInitHigher(url);

                var modal = document.getElementById('myHigherModal');

                $.ajax({
                    url: url,
                    cache: false,
                    beforeSend: function () { $(".loading").show(); },
                    success: function (html) {
                        modal.style.display = "block";
                        $("#myHigherModal").html(html);
                    }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                });


            });

        });

    </script>

    <script>

        function Type() {

            var ChkLoc = $('.cChkExpLoc:checked').val();

            if (ChkLoc) {
                var url = "/Config/DropDown/EnumVATExport";
            }
            else {
                var url = "/Config/DropDown/EnumVAT";
            }

            var $Dropdown = $(".trType");
            DropdownLoad($Dropdown, url, '@Model.SaleType');

            console.log("VAT Type Load")
        }

        $(function () {
            $(".cProductType").on("change", function () {
                console.log("hi didar")

                ProductTypeChange(this);

            });
        });

        function ProductTypeChange(sender) {
            var ProductType = $(sender).val();
            if (ProductType != null && ProductType != "") {
                LoadcProductCategoryDropDown(ProductType);
                LoadcProductDropDown("0", ProductType);
            }
        }

        function LoadcProductCategoryDropDown(ProductType, ProductGroup) {
            console.log(ProductType)
            console.log(ProductGroup)
            $DropDownProductCategory = $(".cProductCategoryId");
            $('select.cProductCategoryId').html("");

            var url = "/Config/DropDown/ProductCategory?IsRaw=" + ProductType;
            $DropDownProductCategory.append($("<option />").val("").text("Select"));
            $DropDownProductCategory.select2("val", '');

            $.ajax({
                url: url,
                type: 'GET',
                beforeSend: function () { $(".loading").show(); },
                success: function (data) {
                    $.each(data, function (i, state) {
                        $DropDownProductCategory.append($("<option />").val(state.Value).text(state.Text));
                    });
                    if (ProductGroup != null || ProductGroup != "" || ProductGroup != "0") {
                        $DropDownProductCategory.select2("val", ProductGroup);
                    }

                },
                complete: function () { $(".loading").fadeOut(200).hide("slow") }

            });
        }


    </script>

    <script>
        $(function () {
            $(".cProductCategoryId").on("change", function () {
                ProductCategoryChange(this);
            });
        });

        function ProductCategoryChange(sender) {

            var ProductCategoryId = $(sender).val();

            if (ProductCategoryId != null && ProductCategoryId != "") {
                LoadcProductDropDown(ProductCategoryId);
            }
        }

        function LoadcProductDropDown(ProductCategoryId, IsRaw, ProductCode) {
            $DropDownProduct = $(".trProduct");
            $('select.trProduct').html("");
            if (IsRaw == null) {
                IsRaw = "";
            }
            var url = "/Config/DropDown/Product?CategoryID=" + ProductCategoryId + "&IsRaw=" + IsRaw;
            $DropDownProduct.append($("<option />").val("").text("Select"));
            $DropDownProduct.select2("val", '');

            $.ajax({
                url: url,
                type: 'GET',
                beforeSend: function () { $(".loading").show(); },
                success: function (data) {
                    $.each(data, function (i, state) {
                        $DropDownProduct.append($("<option />").val(state.Value).text(state.Text));
                    });
                    if (ProductCode != null || ProductCode != "" || ProductCode != "0") {
                        $(".trProduct").select2("val", ProductCode);
                    }
                },
                complete: function () { $(".loading").fadeOut(200).hide("slow") }
            });
        }


    </script>

    @*for reporting*@

    <script>
        function modalInit(url) {
            var modal = document.getElementById('myModal');
            $.ajax({
                url: url,
                cache: false,
                beforeSend: function () { $(".loading").show(); },
                success: function (html) {
                    modal.style.display = "block";
                    $("#myModal").html(html);
                },
                complete: function () { $(".loading").fadeOut(200).hide("slow") }

            });
        }
        $(function () {
            $('.vat11Report').click(function () {
                var post = $('#Post').val();
                //var IdCheek=$('#Id').val()
                //console.log(post);
                if (post == "N" || post == "") {
                    ShowResult("Fail", "Data Not Posted!");
                    return;
                }
                //if (IdCheek == null) {
                //    ShowResult("Fail", "Please select Invoice No");
                //    return;
                //}

                var SalesInvoiceNo = $('.trSalesInvoiceNo').val();

                var url = "/Vms/NBRReport/PrintVAT6_3Meghna?SalesInvoiceNo=" + SalesInvoiceNo + "&Ids=" + '@Model.Id';
                modalInit(url);
            });
            $('.saleReport').click(function () {
                var url = "/Vms/MISReport/PrintSale";
                modalInit(url);
            });
            $('.vat17Report').click(function () {
                //var url = "/Vms/NBRReport/PrintVAT17";
                var ItemNo = $('.trItemNo').val();


                var url = "/Vms/NBRReport/PrintVAT17?itemNo=" + ItemNo;
                modalInit(url);
            });

            $('.trVat16').click(function () {

                var itemNo = $('tr.active .dItem_No').val();
                var invoiceDate = $('.trInvoiceDate').val();

                var url = "/Vms/NBRReport/PrintVAT16?itemNo=" + itemNo + "&invoiceDate=" + invoiceDate;
                modalInit(url);
            });

            $('.vat6_2_1Report').click(function () {
                //var url = "/Vms/NBRReport/PrintVAT17";
                var ItemNo = $('.trItemNo').val();

                var url = "/Vms/NBRReport/PrintVAT6_2_1?itemNo=" + ItemNo;
                modalInit(url);
            });
            $('.vat18Report').click(function () {
                var url = "/Vms/NBRReport/PrintVAT18";
                modalInit(url);
            });


            @*$('.vat11Report').click(function () {
                var post = $('#Post').val();
                //var IdCheek=$('#Id').val()
                //console.log(post);
                if (post == "N" || post == "") {
                    ShowResult("Fail", "Data Not Posted!");
                    return;
                }
                //if (IdCheek == null) {
                //    ShowResult("Fail", "Please select Invoice No");
                //    return;
                //}

                var SalesInvoiceNo = $('.trSalesInvoiceNo').val();

                var url = "/Vms/NBRReport/PrintVAT6_3Meghna?SalesInvoiceNo=" + SalesInvoiceNo + "&Ids=" + '@Model.Id';
                modalInit(url);
            });*@
        })
    </script>

    <script>

        $(function () {

            $("#tripSearch").on("click", function () {

                var tripNo = $(".cSerialNo").val();


                $.getJSON("/vms/SaleInvoice/Searchtrip?tripNo=" + tripNo,
                function (data) {

                    if (data.productName && data.code && data.quantity) {

                        var newOption = new Option(data.productName, data.code, false, false);

                        //$(".trQuantity").val(data.quantity);
                        $('.trProduct').append(newOption);
                        $('.trProduct').val(data.code);
                        $('.trProduct').trigger('change');

                        ProductNameChange(data.code);

                    } else if (data.message) {
                        ShowResult("Fail", data.message);
                    }
                });

            })



        });

        //$('.trVATRate').change(function () {

        //    var VATRate = parseFloat($('.trVATRate').val().replace(/\,/g, ''));
        //    $('.trType').val(VATRate);
        //    VATTypeCal($('.trVATRate').val());

        //});

        //function VATTypeCal(VatRate) {

        //    var rate = parseFloat(VatRate.replace(/\,/g, ''));

        //    var type = "";

        //    if (rate >= 15) {
        //        type = "VAT";
        //    }
        //    else if (rate == 0) {
        //        type = "NonVAT";

        //    }
        //    else if (rate > 0 && rate < 15) {
        //        type = "OtherRate";
        //    }
        //    console.log(type);
        //    //$('.trType').val(type);
        //    $(".trType").select2("val", type);

        //    //console.log("VAT Type Set", Type)

        //}

    </script>

    @*--------------------------Update CPC Name--------------------------*@

    <script>

        function CPCNameUpdateSalesPopUp(sender) {


            var url = "/Vms/SaleInvoice/PopUpCPCNameUpdateSales";

            var $closestRow = $(sender).closest('.tablerow');

            var code = $closestRow.find('.dItemNo').val();
            var name = $closestRow.find('.dItemName').val();
            var UOM = $closestRow.find('.dUOM').val();
            var Quantity = $closestRow.find('.dQuantity ').val();
            var PromotionalQuantity = $closestRow.find('.dPQuantity ').val();
            var NBRPrice = $closestRow.find('.dSalesPrice').val();
            var vSubTotal = $closestRow.find('.dSubTotal').val();
            var TradingMarkUp = $closestRow.find('.dTradingD  ').val();
            var SD = $closestRow.find('.dSD').val();
            var SDAmount = $closestRow.find('.dSDAmount').val();
            var VATRate = $closestRow.find('.dVATRate ').val();
            var VATAmount = $closestRow.find('.dVATAmount ').val();
            var Total = $closestRow.find('.dTotal').val();
            var Type = $closestRow.find('.dType ').val();
            var UOMPrice = $closestRow.find('.dBasePrice ').val();
            var UOMc = $closestRow.find('.dConvFactor').val();
            var UOMn = $closestRow.find('.dBaseUOM   ').val();
            var UOMQty = $closestRow.find('.dBaseQty').val();
            var CurrencyValue = $closestRow.find('.dBDT').val();
            var DollerValue = $closestRow.find('.dDollerValue ').val();
            var VatName = $closestRow.find('.dVatName').val();
            var CConversionDate = $closestRow.find('.dCConversionDate').val();
            var Weight = $closestRow.find('.dWeight ').val();
            var ValueOnly = $closestRow.find('.dValueOnly').val();
            var TotalValue = $closestRow.find('.dTotalValue').val();
            var WareHouseRent = $closestRow.find('.dWareHouseRent').val();
            var WareHouseVAT = $closestRow.find('.dWareHouseVAT').val();
            var ATVRate = $closestRow.find('.dATVRate').val();
            var ATVablePrice = $closestRow.find('.dATVablePrice').val();
            var ATVAmount = $closestRow.find('.dATVAmount').val();
            var IsCommercialImporter = $closestRow.find('.dIsCommercialImporter').val();
            var ProductDescription = $closestRow.find('.dProductDescription').val();
            var CDNVATAmount = $closestRow.find('.dCDNVATAmount').val();
            var CDNSDAmount = $closestRow.find('.dCDNSDAmount').val();
            var CDNSubtotal = $closestRow.find('.dCDNSubtotal').val();

            var ItemNo = $closestRow.find('.dItem_No').val();
            var TradingD = $closestRow.find('.dTradingD').val();
            var NonStockD = $closestRow.find('.dNonStockD').val();
            var SaleTypeD = $closestRow.find('.dSaleTypeD').val();
            var CommentsD = $closestRow.find('.dCommentsD').val();
            var InvoiceLineNo = $closestRow.find('.dInvoiceLineNo').val();

            var PreviousSalesInvoiceNoD = $closestRow.find('.dPreviousSalesInvoiceNo').val();
            var PreviousInvoiceDateTime = $closestRow.find('.dPreviousInvoiceDateTime').val();
            var PreviousNBRPrice = $closestRow.find('.dPreviousNBRPrice').val();
            var PreviousQuantity = $closestRow.find('.dPreviousQuantity').val();
            var PreviousUOM = $closestRow.find('.dPreviousUOM').val();
            var PreviousSubTotal = $closestRow.find('.dPreviousSubTotal').val();
            var PreviousVATAmount = $closestRow.find('.dPreviousVATAmount').val();
            var PreviousVATRate = $closestRow.find('.dPreviousVATRate').val();
            var PreviousSD = $closestRow.find('.dPreviousSD').val();
            var PreviousSDAmount = $closestRow.find('.dPreviousSDAmount').val();
            var ReasonOfReturn = $closestRow.find('.dReasonOfReturn').val();
            var BEItemNo = $closestRow.find('.dBEItemNo').val();
            var CPCName = $closestRow.find('.dCPCName').val();
            var TransactionType = $closestRow.find('.dTransactionType').val();
            var BillingPeriodFrom = $closestRow.find('.dBillingPeriodFrom').val();
            var BillingPeriodTo = $closestRow.find('.dBillingPeriodTo').val();
            var BillingDays = $closestRow.find('.dBillingDays').val();
            var BOMReferenceNo = $closestRow.find('.dBOMReferenceNo').val();
            var IsFixedVAT = $closestRow.find('.dIsFixedVAT').val();
            var BOMId = $closestRow.find('.dBOMId').val();

            var modelData = {
                ProductName: name,
                ProductCode: code,
                UOM: UOM,
                Quantity: Quantity,
                PromotionalQuantity: PromotionalQuantity,
                NBRPrice: NBRPrice,
                SubTotal: vSubTotal,
                TradingMarkUp: TradingMarkUp,
                SD: SD,
                SDAmount: SDAmount,
                VATRate: VATRate,
                VATAmount: VATAmount,
                Total: Total,
                Type: Type,
                UOMPrice: UOMPrice,
                UOMc: UOMc,
                UOMn: UOMn,
                UOMQty: UOMQty,
                CurrencyValue: CurrencyValue,
                DollerValue: DollerValue,
                VatName: VatName,
                CConversionDate: CConversionDate,
                Weight: Weight,
                ValueOnly: ValueOnly,
                TotalValue: TotalValue,
                WareHouseRent: WareHouseRent,
                WareHouseVAT: WareHouseVAT,
                ATVRate: ATVRate,
                ATVablePrice: ATVablePrice,
                ATVAmount: ATVAmount,
                IsCommercialImporter: IsCommercialImporter,
                ProductDescription: ProductDescription,
                CDNVATAmount: CDNVATAmount,
                CDNSDAmount: CDNSDAmount,
                CDNSubtotal: CDNSubtotal,

                ItemNo: ItemNo,
                TradingD: TradingD,
                NonStockD: NonStockD,
                SaleTypeD: SaleTypeD,
                CommentsD: CommentsD,
                InvoiceLineNo: InvoiceLineNo,

                PreviousSalesInvoiceNoD: PreviousSalesInvoiceNoD,
                PreviousInvoiceDateTime: PreviousInvoiceDateTime,
                PreviousNBRPrice: PreviousNBRPrice,
                PreviousQuantity: PreviousQuantity,
                PreviousUOM: PreviousUOM,
                PreviousSubTotal: PreviousSubTotal,
                PreviousVATAmount: PreviousVATAmount,
                PreviousVATRate: PreviousVATRate,
                PreviousSD: PreviousSD,
                PreviousSDAmount: PreviousSDAmount,
                ReasonOfReturn: ReasonOfReturn,
                BEItemNo: BEItemNo,
                CPCName: CPCName,
                TransactionType: TransactionType,
                BillingPeriodFrom: BillingPeriodFrom,
                BillingPeriodTo: BillingPeriodTo,
                BillingDays: BillingDays,
                BOMReferenceNo: BOMReferenceNo,
                IsFixedVAT: IsFixedVAT,
                BOMId: BOMId

            }

            console.log(modelData);

            $(sender).parents("tr:first").remove();

            SubTotal();

            var modal = document.getElementById('myHigherModal');

            $.ajax({
                data: modelData,
                url: url,
                cache: false,
                beforeSend: function () { $(".loading").show(); },
                success: function (html) {
                    modal.style.display = "block";
                    $("#myHigherModal").html(html);

                }
            , complete: function () { $(".loading").fadeOut(200).hide("slow") }

            });


        }

        function callbackCPCNameUpdateSalesModal(model) {

            url = "/Vms/SaleInvoice/CPCNameUpdate";
            container = "editorItemRows4";
            $.ajax({
                data: model,
                url: url,
                cache: false,
                success: function (html) {
                    $("#" + container).append(html);
                    callingFixedTable();
                    SubTotal();
                }
            });

        }

        $("#EngineInfoTabNita #btnTraking").on("click", function () {

            var questionMSG = "Are you sure to Save Trakings!";
            Ask(questionMSG, function () {

                var SalesInvoiceNo = $("#Sale .trSalesInvoiceNo").val();
                var TransactionType = '@Model.TransactionType';
                @*var BranchId = '@Model.BranchId';*@
                //TransactionType
                if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    ShowResult("Fail", "You are requested to Save before Change!");
                    return;
                }

                ////var $Items = $("#EngineInfoTab .dSelected:input:checkbox:checked");
                var $Items = $("#EngineInfoTabNita .dIsSelect:input:checkbox:checked");

                if ($Items == null || $Items.length == 0) {
                    ShowResult("Fail", "You are requested to Select before Change!");
                    return;
                }

                IDs = [];
                console.log($Items);

                $Items.each(function (item) {


                    ////var SalesInvoiceNo = $(this).closest('tr').find('.SalesInvoiceNo').text();
                    var ItemNo = $(this).closest('tr').find('.dItemNoT').val();
                    var IsSale = $(this).closest('tr').find('.dIsSale').val();
                    var FinishItemNo = $(this).closest('tr').find('.dFinishItemNo').val();
                    var Heading1 = $(this).closest('tr').find('.dHeading1T').val();
                    //var SalesInvoiceNo = $(this).closest('tr').find('.dSaleInvoiceNo').text();

                    //console.log(SalesInvoiceNo);

                    //if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    //    return;
                    //}



                    items = {}
                    items["SaleInvoiceNo"] = SalesInvoiceNo;
                    items["ItemNo"] = ItemNo;
                    items["IsSale"] = "Y";
                    items["FinishItemNo"] = FinishItemNo;
                    items["Heading1"] = Heading1;
                    items["transactionType"] = TransactionType;
                    //item["ProductCode"] = ProductCode;

                    IDs.push(items);
                    //console.log(item)

                });


                var model = {
                    IDs: IDs,
                    //BranchId: BranchId
                }
                console.log(model)
                var url = '/VMS/SaleInvoice/TrakingsUpdate';


                $.ajax({
                    url: url
                , data: JSON.stringify(model)
                , type: 'Post'
                , traditional: true
                , beforeSend: function () { $(".loading").show(); }
                , success: function (rVM) {
                    ShowResult(rVM.Status, rVM.Message);

                    if (rVM.Status == "Success") {
                        //SearchEngine();
                    }
                }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                , contentType: 'application/json; charset=utf-8'
                , dataType: 'json'

                });



            });


        });


        $('.AddRowDeliveryTraking').on("click", function () {

            //var product = $('.trProduct').val();
            //if (product == "0" || product == "") {
            //    ShowResult("Fail", "Select a product first!");
            //    return;
            //}

            //var PurchaseNo = $('.trPurchaseNo').val();
            //if (PurchaseNo == "0" || PurchaseNo == "") {
            //    ShowResult("Fail", "Select a Purchase No first!");
            //    return;
            //}


            var itemName = $('.trProductName').val();
            var count = 0;

            $('.dItemName').each(function () {
                var existing = $(this).val();
                if (itemName == existing) {
                    count++;
                }
            });

            if (count > 0) {
                ShowResult("Fail", "Item already exists!");
                return;
            }

            var container = $(this).attr('data-container');
            var url = $(this).attr('data-url');
            AddRowDeliveryTraking(container, url)
            return false;
        });


        $("#DeliveryChallanTraking #btnDeliveryTraking").on("click", function () {

            var questionMSG = "Are you sure to Save Sale delivery challan!";
            Ask(questionMSG, function () {

                var SalesInvoiceNo = $("#Sale .trSalesInvoiceNo").val();
                var TransactionType = '@Model.TransactionType';
                @*var BranchId = '@Model.BranchId';*@
                //TransactionType
                if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    ShowResult("Fail", "You are requested to Save before Change!");
                    return;
                }

                var post = $("#Post").val();
                if (post == "N" || post == "") {
                    ShowResult("Fail", "You are requested to Post sales challan before delivery challan save!");
                    return;
                }

                ////var $Items = $("#EngineInfoTab .dSelected:input:checkbox:checked");
                //var $Items = $("#EngineInfoTabNita .dIsSelect:input:checkbox:checked");
                //var $ItemsDC = $("#DeliveryChallanTraking .dIsSelect:input:checkbox:checked");
                var $ItemsDC = $("#DeliveryChallanTraking .ddItemName:input");

                if ($ItemsDC == null || $ItemsDC.length == 0) {
                    ShowResult("Fail", "You are requested to add before Save!");
                    return;
                }

                var customerId = $(".trCustomerId").val();
                var ChallanDate = $(".trInvoiceDate").val();
                var PONo = $(".cPONo").val();
                var PODate = $(".trPODate").val();
                debugger

                dcIDs = [];
                console.log($ItemsDC.length);

                $ItemsDC.each(function (itemDC) {

                    ////alert(item);
                    ////var SalesInvoiceNo = $(this).closest('tr').find('.SalesInvoiceNo').text();
                    var ItemNo = $(this).closest('tr').find('.ddItemNo').val();
                    var Quantity = $(this).closest('tr').find('.ddQuantity').val();
                    var UnitPrice = $(this).closest('tr').find('.ddUnitPrice').val();
                    var SubTotal = $(this).closest('tr').find('.ddSubTotal').val();
                    var PartialDescription = $(this).closest('tr').find('.ddPartialDescription').val();
                    //var SalesInvoiceNo = $(this).closest('tr').find('.dSaleInvoiceNo').text();

                    ////alert(Quantity);
                    console.log(ItemNo);

                    console.log(PartialDescription);

                    //if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    //    return;
                    //}




                    itemsDC = {}
                    itemsDC["DeliveryChallanNo"] = SalesInvoiceNo;
                    itemsDC["CustomerID"] = customerId;
                    itemsDC["ItemNo"] = ItemNo;
                    itemsDC["ChallanDate"] = ChallanDate;
                    itemsDC["PONo"] = PONo;
                    itemsDC["PODate"] = PODate;
                    itemsDC["Quantity"] = Quantity;
                    itemsDC["UnitPrice"] = UnitPrice;

                    itemsDC["SubTotal"] = SubTotal;
                    itemsDC["PartialDescription"] = PartialDescription;

                    itemsDC["transactionType"] = TransactionType;
                    //item["ProductCode"] = ProductCode;

                    dcIDs.push(itemsDC);
                    //console.log(item)

                });


                var model = {
                    IDs: dcIDs,
                    //BranchId: BranchId
                }
                console.log(model)
                var url = '/VMS/SaleInvoice/SaleDeliveryAdd';


                $.ajax({
                    url: url
                , data: JSON.stringify(model)
                , type: 'Post'
                , traditional: true
                , beforeSend: function () { $(".loading").show(); }
                , success: function (rVM) {
                    ShowResult(rVM.Status, rVM.Message);

                    if (rVM.Status == "Success") {
                        //SearchEngine();
                    }
                }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                , contentType: 'application/json; charset=utf-8'
                , dataType: 'json'

                });



            });


        });

        $("#DeliveryChallanTraking #btnDeliveryTrakingUpdate").on("click", function () {

            var questionMSG = "Are you sure to Update Sale delivery challan!";
            Ask(questionMSG, function () {

                var SalesInvoiceNo = $("#Sale .trSalesInvoiceNo").val();
                var TransactionType = '@Model.TransactionType';
                @*var BranchId = '@Model.BranchId';*@
                //TransactionType
                if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    ShowResult("Fail", "You are requested to Save before Change!");
                    return;
                }

                var post = $("#Post").val();
                if (post == "N" || post == "") {
                    ShowResult("Fail", "You are requested to Post sales challan before delivery challan save!");
                    return;
                }

                ////var $Items = $("#EngineInfoTab .dSelected:input:checkbox:checked");
                //var $Items = $("#EngineInfoTabNita .dIsSelect:input:checkbox:checked");
                //var $ItemsDC = $("#DeliveryChallanTraking .dIsSelect:input:checkbox:checked");
                var $ItemsDC = $("#DeliveryChallanTraking .ddItemName:input");

                if ($ItemsDC == null || $ItemsDC.length == 0) {
                    ShowResult("Fail", "You are requested to add before Save!");
                    return;
                }

                var customerId = $(".trCustomerId").val();
                var ChallanDate = $(".trInvoiceDate").val();
                var PONo = $(".cPONo").val();
                var PODate = $(".trPODate").val();
                var post = "";
                debugger

                dcIDs = [];
                console.log($ItemsDC.length);

                $ItemsDC.each(function (itemDC) {

                    ////alert(item);
                    ////var SalesInvoiceNo = $(this).closest('tr').find('.SalesInvoiceNo').text();
                    var ItemNo = $(this).closest('tr').find('.ddItemNo').val();
                    var Quantity = $(this).closest('tr').find('.ddQuantity').val();
                    var UnitPrice = $(this).closest('tr').find('.ddUnitPrice').val();
                    var SubTotal = $(this).closest('tr').find('.ddSubTotal').val();
                    var PartialDescription = $(this).closest('tr').find('.ddPartialDescription').val();
                    //var SalesInvoiceNo = $(this).closest('tr').find('.dSaleInvoiceNo').text();
                    post = $(this).closest('tr').find('.ddPost').val();

                    ////alert(Quantity);
                    console.log(ItemNo);

                    console.log(PartialDescription);

                    //if (SalesInvoiceNo == null || SalesInvoiceNo == "") {
                    //    return;
                    //}




                    itemsDC = {}
                    itemsDC["DeliveryChallanNo"] = SalesInvoiceNo;
                    itemsDC["CustomerID"] = customerId;
                    itemsDC["ItemNo"] = ItemNo;
                    itemsDC["ChallanDate"] = ChallanDate;
                    itemsDC["PONo"] = PONo;
                    itemsDC["PODate"] = PODate;
                    itemsDC["Quantity"] = Quantity;
                    itemsDC["UnitPrice"] = UnitPrice;

                    itemsDC["SubTotal"] = SubTotal;
                    itemsDC["PartialDescription"] = PartialDescription;

                    itemsDC["transactionType"] = TransactionType;
                    //item["ProductCode"] = ProductCode;

                    dcIDs.push(itemsDC);
                    //console.log(item)

                });

                if (post.toLowerCase() == 'true' || post.toLowerCase() == 'y') {
                    ShowResult("Fail", "Data Already Posted!");
                    return;
                }

                var model = {
                    IDs: dcIDs,
                    //BranchId: BranchId
                }
                console.log(model)
                var url = '/VMS/SaleInvoice/SaleDeliveryUpdate';


                $.ajax({
                    url: url
                , data: JSON.stringify(model)
                , type: 'Post'
                , traditional: true
                , beforeSend: function () { $(".loading").show(); }
                , success: function (rVM) {
                    ShowResult(rVM.Status, rVM.Message);

                    if (rVM.Status == "Success") {
                        //SearchEngine();
                    }
                }
                , complete: function () { $(".loading").fadeOut(200).hide("slow") }
                , contentType: 'application/json; charset=utf-8'
                , dataType: 'json'

                });



            });


        });



        function PostDataDeliveryChallan(sender) {

            var SalesInvoiceNo = $("#Sale .trSalesInvoiceNo").val();
            debugger
            //var Id = $("#Id").val();
            //var Post = $("#Post").val();

            var $ItemsDC = $("#DeliveryChallanTraking .ddItemName:input");
            var post = "";
            $ItemsDC.each(function (itemDC) {


                //var ItemNo = $(this).closest('tr').find('.ddItemNo').val();

                post = $(this).closest('tr').find('.ddPost').val();


            });

            debugger
            //var post = $(this).closest('tr').find('.ddPost').val();
            if (post.toLowerCase() == 'true' || post.toLowerCase() == 'y') {
                ShowResult("Fail", "Data Already Posted!");
                return;
            }
            var url = '/Vms/SaleInvoice/PostDeleveryChallan?ids=' + SalesInvoiceNo + '~';
            var questionMSG = "Are you sure to Post Data!";
            singlePostDlete(questionMSG, url);
        }



    </script>
}

